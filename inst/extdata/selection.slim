1 late() {
  defineConstant("LOCATION", asFloat(c({{coord}})));
  defineConstant("FREQ", asFloat({{freq}}));
  defineConstant("S", asFloat({{s}}));
  defineConstant("T_ONSET", SIM_END - asInteger(round({{onset}} / GEN_TIME)));
  defineConstant("POP", which(NAMES == "{{origin}}"));

  sim.rescheduleScriptBlock(s999, generations = T_ONSET);
}

s999 late() {
  log_output("Introducing a beneficial mutation");
  if (get_pop(POP).spatialMapValue("world", LOCATION) == 1.0)
    stop("Location of selection start outside of the population boundary!\n");

  all_genomes = get_pop(POP).genomes;
  sampled_genomes = sample(all_genomes, asInteger(length(all_genomes) * FREQ));
  sampled_genomes.addNewMutation(get_pop(POP).id, S, asInteger(SEQ_LENGTH / 2));
  sampled_genomes.individual.setSpatialPosition(LOCATION);
}
