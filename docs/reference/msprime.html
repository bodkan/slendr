<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run a slendr model in msprime — msprime • slendr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run a slendr model in msprime — msprime"><meta name="description" content="This function will execute a built-in msprime script and run a compiled
slendr demographic model."><meta property="og:description" content="This function will execute a built-in msprime script and run a compiled
slendr demographic model."><meta property="og:image" content="https://bodkan.net/slendr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slendr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-question-circle"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vignette-00-installation.html">Installation instructions</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-01-tutorial.html">Introduction and basic tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-02-grid-model.html">Demes on a regular spatial grid</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-03-interactions.html">Programming dispersion dynamics</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-04-nonspatial-models.html">Traditional non-spatial models</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-05-tree-sequences.html">Tree sequence processing and statistics</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-06-locations.html">Spatially annotated tree sequences</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-07-backends.html">Simulating data with SLiM and msprime backends</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-08-nonslendr-tskit.html">Standard SLiM and msprime tree sequences</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-09-paper.html">Examples from the slendr paper</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-10-tracts.html">Extracting true ancestry tracts</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-11-extensions.html">Extending models with custom SLiM code</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/bodkan/slendr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run a slendr model in msprime</h1>
      <small class="dont-index">Source: <a href="https://github.com/bodkan/slendr/blob/HEAD/R/msprime.R" class="external-link"><code>R/msprime.R</code></a></small>
      <div class="d-none name"><code>msprime.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function will execute a built-in msprime script and run a compiled
slendr demographic model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">msprime</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">sequence_length</span>,</span>
<span>  <span class="va">recombination_rate</span>,</span>
<span>  samples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  run <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coalescent_only <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Model object created by the <code>compile</code> function</p></dd>


<dt id="arg-sequence-length">sequence_length<a class="anchor" aria-label="anchor" href="#arg-sequence-length"></a></dt>
<dd><p>Total length of the simulated sequence (in base-pairs)</p></dd>


<dt id="arg-recombination-rate">recombination_rate<a class="anchor" aria-label="anchor" href="#arg-recombination-rate"></a></dt>
<dd><p>Recombination rate of the simulated sequence (in
recombinations per basepair per generation)</p></dd>


<dt id="arg-samples">samples<a class="anchor" aria-label="anchor" href="#arg-samples"></a></dt>
<dd><p>A data frame of times at which a given number of individuals
should be remembered in the tree-sequence (see <code>schedule_sampling</code> for a
function that can generate the sampling schedule in the correct format). If
missing, only individuals present at the end of the simulation will be
recorded in the final tree-sequence file.</p></dd>


<dt id="arg-random-seed">random_seed<a class="anchor" aria-label="anchor" href="#arg-random-seed"></a></dt>
<dd><p>Random seed (if <code>NULL</code>, a seed will be generated between
0 and the maximum integer number available)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Write the log information from the SLiM run to the console
(default <code>FALSE</code>)?</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>Write msprime's debug log to the console (default <code>FALSE</code>)?</p></dd>


<dt id="arg-run">run<a class="anchor" aria-label="anchor" href="#arg-run"></a></dt>
<dd><p>Should the msprime engine be run? If <code>FALSE</code>, the command line msprime
command will be printed (and returned invisibly as a character vector) but not executed.</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path to the directory where simulation result files will be saved.
If <code>NULL</code>, this directory will be automatically created as a temporary
directory. If <code>TRUE</code>, this path will be also returned by the function.
If a string is given, it is assumed to be a path to a directory where simulation
results will be saved. In this case, the function will return this path invisibly.
Note that if a tree-sequence file should be simulated (along with other files,
potentially), that tree-sequence file (named 'msprime.trees' by default) will
have to be explicitly loaded using <code><a href="ts_read.html">ts_read()</a></code>.</p></dd>


<dt id="arg-coalescent-only">coalescent_only<a class="anchor" aria-label="anchor" href="#arg-coalescent-only"></a></dt>
<dd><p>Default is <code>TRUE</code>, which will only record the
minimum amount of information necessary to represent the genealogical
history of the simulated samples (i.e., only nodes which are MRCA of some
pair of samples at some locus in the genome). Setting to <code>FALSE</code> will
record much more information, resulting in unary nodes in the tree sequence.
This parameter translates to the <code>coalescing_segments_only</code> argument
of the underlying msprime method <code>sim_ancestry</code>. See Details for
additional information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tree-sequence object loaded via Python-R reticulate interface function <code>ts_read</code>
(internally represented by the Python object <code>tskit.trees.TreeSequence</code>). If the
<code>path</code> argument was set, it will return the path as a single-element character vector.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For more information about the <code>coalescent_only</code> argument, please see
msprime documentation, particularly the section on "Recording more information"
and the <code>coalescing_segments_only</code> argument of the method <code>sim_ancestry()</code>
here <a href="https://tskit.dev/msprime/docs/stable/ancestry.html#recording-more-information" class="external-link">https://tskit.dev/msprime/docs/stable/ancestry.html#recording-more-information</a>.
and <a href="https://tskit.dev/msprime/docs/stable/api.html#msprime.sim_ancestry" class="external-link">https://tskit.dev/msprime/docs/stable/api.html#msprime.sim_ancestry</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="init_env.html">init_env</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The interface to all required Python modules has been activated.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load an example model</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_model.html">read_model</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/models/introgression"</span>, package <span class="op">=</span> <span class="st">"slendr"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># afr and eur objects would normally be created before slendr model compilation,</span></span></span>
<span class="r-in"><span><span class="co"># but here we take them out of the model object already compiled for this</span></span></span>
<span class="r-in"><span><span class="co"># example (in a standard slendr simulation pipeline, this wouldn't be necessary)</span></span></span>
<span class="r-in"><span><span class="va">afr</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">populations</span><span class="op">[[</span><span class="st">"AFR"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">eur</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">populations</span><span class="op">[[</span><span class="st">"EUR"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">chimp</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">populations</span><span class="op">[[</span><span class="st">"CH"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># schedule the sampling of a couple of ancient and present-day individuals</span></span></span>
<span class="r-in"><span><span class="co"># given model at 20 ky, 10 ky, 5ky ago and at present-day (time 0)</span></span></span>
<span class="r-in"><span><span class="va">modern_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="schedule_sampling.html">schedule_sampling</a></span><span class="op">(</span><span class="va">model</span>, times <span class="op">=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">afr</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eur</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">chimp</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ancient_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="schedule_sampling.html">schedule_sampling</a></span><span class="op">(</span><span class="va">model</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">30000</span>, <span class="fl">20000</span>, <span class="fl">10000</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eur</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># sampling schedules are just data frames and can be merged easily</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">modern_samples</span>, <span class="va">ancient_samples</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run a simulation using the msprime back end from a compiled slendr model object</span></span></span>
<span class="r-in"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu">msprime</span><span class="op">(</span><span class="va">model</span>, sequence_length <span class="op">=</span> <span class="fl">1e5</span>, recombination_rate <span class="op">=</span> <span class="fl">0</span>, samples <span class="op">=</span> <span class="va">samples</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulated tree-sequence object can be saved to a file using ts_write()...</span></span></span>
<span class="r-in"><span><span class="va">ts_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".trees"</span><span class="op">)</span>, winslash <span class="op">=</span> <span class="st">"/"</span>, mustWork <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ts_write.html">ts_write</a></span><span class="op">(</span><span class="va">ts</span>, <span class="va">ts_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># ... and, at a later point, loaded by ts_read()</span></span></span>
<span class="r-in"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="ts_read.html">ts_read</a></span><span class="op">(</span><span class="va">ts_file</span>, <span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╔═══════════════════════════╗</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║TreeSequence               ║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╠═══════════════╤═══════════╣</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Trees          │          1║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────────┼───────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Sequence Length│    100,000║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────────┼───────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Time Units     │generations║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────────┼───────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Sample Nodes   │        230║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────────┼───────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Total Size     │   39.3 KiB║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╚═══════════════╧═══════════╝</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╔═══════════╤════╤═════════╤════════════╗</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Table      │Rows│Size     │Has Metadata║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╠═══════════╪════╪═════════╪════════════╣</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Edges      │ 470│ 14.7 KiB│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Individuals│ 115│  3.2 KiB│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Migrations │   0│  8 Bytes│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Mutations  │   0│ 16 Bytes│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Nodes      │ 471│ 12.9 KiB│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Populations│   4│338 Bytes│         Yes║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Provenances│   1│  2.9 KiB│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╟───────────┼────┼─────────┼────────────╢</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ║Sites      │   0│ 16 Bytes│          No║</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ╚═══════════╧════╧═════════╧════════════╝</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Petr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

