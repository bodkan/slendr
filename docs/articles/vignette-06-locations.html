<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with spatially annotated tree-sequences • slendr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Working with spatially annotated tree-sequences">
<meta property="og:description" content="slendr">
<meta property="og:image" content="https://bodkan.net/slendr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slendr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-question-circle"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette-01-tutorial.html">Introduction and basic tutorial</a>
    </li>
    <li>
      <a href="../articles/vignette-02-grid-model.html">Demes on a regular spatial grid</a>
    </li>
    <li>
      <a href="../articles/vignette-03-interactions.html">Programming dispersion dynamics</a>
    </li>
    <li>
      <a href="../articles/vignette-04-nonspatial-models.html">Traditional non-spatial models</a>
    </li>
    <li>
      <a href="../articles/vignette-05-tree-sequences.html">Tree-sequence processing and statistics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bodkan/slendr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fleventy5">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-06-locations_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with spatially annotated tree-sequences</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bodkan/slendr/blob/master/vignettes/vignette-06-locations.Rmd"><code>vignettes/vignette-06-locations.Rmd</code></a></small>
      <div class="hidden name"><code>vignette-06-locations.Rmd</code></div>

    </div>

    
    
<p><strong>Note:</strong> This vignette is a work in progress as the spatial tree-sequence features in <em>slendr</em> are still being designed and implemented. Please check back later to see if this notice has been removed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bodkan/slendr">slendr</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:testthat':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     matches</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/use_python.html">use_virtualenv</a></span><span class="op">(</span><span class="st">"~/.pyenv/versions/retipy"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div id="model-specification" class="section level2">
<h2 class="hasAnchor">
<a href="#model-specification" class="anchor"></a>Model specification</h2>
<p>First, let’s program our spatial model. To keep things consistent across our various tutorials, we will use the same demographic model of modern human history in West Eurasia which we extensively discussed in the <a href="vignette-01-tutorial.html">introductory tutorial</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#</span>
<span class="co"># define the world map</span>
<span class="co">#</span>
<span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/world.html">world</a></span><span class="op">(</span>
  xrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">60</span><span class="op">)</span>,
  yrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">65</span><span class="op">)</span>,
  crs <span class="op">=</span> <span class="st">"EPSG:3035"</span>
<span class="op">)</span></code></pre></div>
<pre><code>#&gt; OGR data source with driver: ESRI Shapefile 
#&gt; Source: "/private/var/folders/hr/_t1b0f5n7c76yrfsg8yk9l100000gn/T/RtmpEoSM0b", layer: "ne_110m_land"
#&gt; with 127 features
#&gt; It has 3 fields</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#</span>
<span class="co"># define a couple of broad geographic regions</span>
<span class="co"># </span>
<span class="va">africa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region.html">region</a></span><span class="op">(</span><span class="st">"Africa"</span>, <span class="va">map</span>, polygon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">18</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">33</span><span class="op">)</span>,
                                               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">32</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region.html">region</a></span><span class="op">(</span><span class="st">"Europe"</span>, <span class="va">map</span>, polygon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">36</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">38</span><span class="op">)</span>,
                                               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">45</span><span class="op">)</span>,
                                               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">58</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">anatolia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region.html">region</a></span><span class="op">(</span><span class="st">"Anatolia"</span>, <span class="va">map</span>, polygon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">40</span><span class="op">)</span>,
                                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">43</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">27</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">38</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#</span>
<span class="co"># define population histories</span>
<span class="co"># </span>
<span class="va">afr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span> <span class="co"># African ancestral population</span>
  <span class="st">"AFR"</span>, parent <span class="op">=</span> <span class="st">"ancestor"</span>, time <span class="op">=</span> <span class="fl">52000</span>, N <span class="op">=</span> <span class="fl">3000</span>,
  map <span class="op">=</span> <span class="va">map</span>, polygon <span class="op">=</span> <span class="va">africa</span>
<span class="op">)</span>

<span class="va">ooa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span> <span class="co"># population of the first migrants out of Africa</span>
  <span class="st">"OOA"</span>, parent <span class="op">=</span> <span class="va">afr</span>, time <span class="op">=</span> <span class="fl">51000</span>, N <span class="op">=</span> <span class="fl">500</span>, remove <span class="op">=</span> <span class="fl">25000</span>,
  center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">30</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">400e3</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/move.html">move</a></span><span class="op">(</span>
    trajectory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span>,
    start <span class="op">=</span> <span class="fl">50000</span>, end <span class="op">=</span> <span class="fl">40000</span>, snapshots <span class="op">=</span> <span class="fl">20</span>
  <span class="op">)</span>

<span class="va">ehg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span> <span class="co"># Eastern hunter-gatherers</span>
  <span class="st">"EHG"</span>, parent <span class="op">=</span> <span class="va">ooa</span>, time <span class="op">=</span> <span class="fl">28000</span>, N <span class="op">=</span> <span class="fl">1000</span>, remove <span class="op">=</span> <span class="fl">6000</span>,
  polygon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">55</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">53</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">53</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">53</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">63</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">63</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">eur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span> <span class="co"># European population</span>
  name <span class="op">=</span> <span class="st">"EUR"</span>, parent <span class="op">=</span> <span class="va">ehg</span>, time <span class="op">=</span> <span class="fl">25000</span>, N <span class="op">=</span> <span class="fl">2000</span>,
  polygon <span class="op">=</span> <span class="va">europe</span>
<span class="op">)</span>

<span class="va">ana</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span> <span class="co"># Anatolian farmers</span>
  name <span class="op">=</span> <span class="st">"ANA"</span>, time <span class="op">=</span> <span class="fl">28000</span>, N <span class="op">=</span> <span class="fl">3000</span>, parent <span class="op">=</span> <span class="va">ooa</span>, remove <span class="op">=</span> <span class="fl">4000</span>,
  center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">38</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">500e3</span>, polygon <span class="op">=</span> <span class="va">anatolia</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expand.html">expand</a></span><span class="op">(</span> <span class="co"># expand the range by 2.500 km</span>
    by <span class="op">=</span> <span class="fl">2500e3</span>, start <span class="op">=</span> <span class="fl">10000</span>, end <span class="op">=</span> <span class="fl">7000</span>,
    polygon <span class="op">=</span> <span class="fu"><a href="../reference/join.html">join</a></span><span class="op">(</span><span class="va">europe</span>, <span class="va">anatolia</span><span class="op">)</span>, snapshots <span class="op">=</span> <span class="fl">20</span>
  <span class="op">)</span>

<span class="va">yam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span> <span class="co"># Yamnaya steppe population</span>
  name <span class="op">=</span> <span class="st">"YAM"</span>, time <span class="op">=</span> <span class="fl">7000</span>, N <span class="op">=</span> <span class="fl">500</span>, parent <span class="op">=</span> <span class="va">ehg</span>, remove <span class="op">=</span> <span class="fl">2500</span>,
  polygon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">49</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">50</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">56</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">59</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">56</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/move.html">move</a></span><span class="op">(</span>trajectory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>, start <span class="op">=</span> <span class="fl">5000</span>, end <span class="op">=</span> <span class="fl">3000</span>, snapshots <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co">#</span>
<span class="co"># define geneflow events</span>
<span class="co">#</span>
<span class="va">gf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/geneflow.html">geneflow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ana</span>, to <span class="op">=</span> <span class="va">yam</span>, rate <span class="op">=</span> <span class="fl">0.5</span>, start <span class="op">=</span> <span class="fl">6500</span>, end <span class="op">=</span> <span class="fl">6400</span>, overlap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/geneflow.html">geneflow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ana</span>, to <span class="op">=</span> <span class="va">eur</span>, rate <span class="op">=</span> <span class="fl">0.5</span>, start <span class="op">=</span> <span class="fl">8000</span>, end <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/geneflow.html">geneflow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">yam</span>, to <span class="op">=</span> <span class="va">eur</span>, rate <span class="op">=</span> <span class="fl">0.75</span>, start <span class="op">=</span> <span class="fl">4000</span>, end <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span>
<span class="op">)</span>

<span class="co">#</span>
<span class="co"># compile the spatial model</span>
<span class="co">#</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compile.html">compile</a></span><span class="op">(</span>
  populations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">afr</span>, <span class="va">ooa</span>, <span class="va">ehg</span>, <span class="va">eur</span>, <span class="va">ana</span>, <span class="va">yam</span><span class="op">)</span>,
  geneflow <span class="op">=</span> <span class="va">gf</span>,
  generation_time <span class="op">=</span> <span class="fl">30</span>, resolution <span class="op">=</span> <span class="fl">10e3</span>,
  competition_dist <span class="op">=</span> <span class="fl">130e3</span>, mate_dist <span class="op">=</span> <span class="fl">100e3</span>, dispersal_dist <span class="op">=</span> <span class="fl">70e3</span>,
  dir <span class="op">=</span> <span class="st">"~/Desktop/sims"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p>Here is a graph summarising population relationships, split times and geneflow events (this is the same plot we show in the <a href="vignette-05-tree-sequences.html">introductory tutorial</a>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_graph.html">plot_graph</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-06-locations_files/figure-html/model_graph-1.png" width="672"></p>
</div>
<div id="scheduling-sampling-events-and-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#scheduling-sampling-events-and-simulation" class="anchor"></a>Scheduling sampling events and simulation</h2>
<p>In the next step, we will schedule the sampling of one individual from each population every one thousand years, starting from 40 thousand years ago to the present (again, a feature already discussed in the <a href="vignette-05-tree-sequences.html#scheduling-of-sampling-events-1">tree-sequence overview</a>):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># one ancient individual every 1 thousand years</span>
<span class="va">ancient</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampling.html">sampling</a></span><span class="op">(</span>times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">500</span><span class="op">)</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ooa</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ehg</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">eur</span>, <span class="fl">1</span><span class="op">)</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ana</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">yam</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 40 present-day Africans, 100 present-day Europeans</span>
<span class="va">present</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampling.html">sampling</a></span><span class="op">(</span>times <span class="op">=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">afr</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">eur</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>

<span class="co"># combine sampling schedules (i.e. data frames) into one</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ancient</span>, <span class="va">present</span><span class="op">)</span>
<span class="va">samples</span></code></pre></div>
<pre><code>#&gt; # A tibble: 183 x 3
#&gt;     time pop       n
#&gt;    &lt;int&gt; &lt;chr&gt; &lt;int&gt;
#&gt;  1 40000 OOA       1
#&gt;  2 39500 OOA       1
#&gt;  3 39000 OOA       1
#&gt;  4 38500 OOA       1
#&gt;  5 38000 OOA       1
#&gt;  6 37500 OOA       1
#&gt;  7 37000 OOA       1
#&gt;  8 36500 OOA       1
#&gt;  9 36000 OOA       1
#&gt; 10 35500 OOA       1
#&gt; # … with 173 more rows</code></pre>
<p>With this done, we can simulate data. Because we want to explore how to handle spatiotemporal population genomic tree-sequence data in <em>slendr</em>, we have to turn on the tree-sequence recording (<code>ts_recording = TRUE</code>). We also need to specify the sampling schedule created in the previous chunk (without it, all individuals present at the very end of the simulation would be sampled):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/slim.html">slim</a></span><span class="op">(</span>
  <span class="va">model</span>, seq_length <span class="op">=</span> <span class="fl">10e6</span>, recomb_rate <span class="op">=</span> <span class="fl">1e-8</span>,
  save_locations <span class="op">=</span> <span class="cn">TRUE</span>, ts_recording <span class="op">=</span> <span class="cn">TRUE</span>, sampling <span class="op">=</span> <span class="va">samples</span>,
  method <span class="op">=</span> <span class="st">"batch"</span>, seed <span class="op">=</span> <span class="fl">314159</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p>After the simulation is done, we can load the data in the same way we did in our <a href="vignette-05-tree-sequences.html#loading-and-processing-tree-sequence-output-files-1">first exploration</a> of tree-sequence features in <em>slendr</em>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_load.html">ts_load</a></span><span class="op">(</span><span class="va">model</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ts</span></code></pre></div>
<pre><code>#&gt; ╔══════════════════════════╗
#&gt; ║TreeSequence              ║
#&gt; ╠═══════════════╤══════════╣
#&gt; ║Trees          │     10509║
#&gt; ╟───────────────┼──────────╢
#&gt; ║Sequence Length│10000000.0║
#&gt; ╟───────────────┼──────────╢
#&gt; ║Sample Nodes   │       662║
#&gt; ╟───────────────┼──────────╢
#&gt; ║Total Size     │   1.7 MiB║
#&gt; ╚═══════════════╧══════════╝
#&gt; ╔═══════════╤═════╤═════════╤════════════╗
#&gt; ║Table      │Rows │Size     │Has Metadata║
#&gt; ╠═══════════╪═════╪═════════╪════════════╣
#&gt; ║Edges      │40397│  1.1 MiB│          No║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Individuals│  331│ 22.2 KiB│         Yes║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Migrations │    0│  4 Bytes│          No║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Mutations  │    0│  1.2 KiB│          No║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Nodes      │ 7637│254.2 KiB│         Yes║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Populations│    6│  2.9 KiB│         Yes║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Provenances│    2│ 29.6 KiB│          No║
#&gt; ╟───────────┼─────┼─────────┼────────────╢
#&gt; ║Sites      │    0│  8 Bytes│          No║
#&gt; ╚═══════════╧═════╧═════════╧════════════╝</code></pre>
</div>
<div id="extracting-spatial-tree-sequence-data" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-spatial-tree-sequence-data" class="anchor"></a>Extracting spatial tree-sequence data</h2>
<p>As we showed in the tutorial to <a href="">tree-sequence data</a> in <em>slendr</em>, a useful function for data exploration is <code><a href="../reference/ts_individuals.html">ts_individuals()</a></code> which, for a given tree-sequence object loaded and annotated by <em>slendr</em>, extracts all information about individuals recorded in the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_individuals.html">ts_individuals</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 331 x 16
#&gt;    name     id pedigree_id chr1_id chr2_id raster_x raster_y remembered retained
#&gt;    &lt;chr&gt; &lt;int&gt;       &lt;int&gt;   &lt;int&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;lgl&gt;      &lt;lgl&gt;   
#&gt;  1 OOA1    150     1441668       0     331     644.     273. TRUE       FALSE   
#&gt;  2 OOA2    151     1502890       1     332     648.     278. TRUE       FALSE   
#&gt;  3 OOA3    152     1560347       2     333     688.     335. TRUE       FALSE   
#&gt;  4 OOA4    153     1622207       3     334     644.     326. TRUE       FALSE   
#&gt;  5 OOA5    154     1683493       4     335     685.     313. TRUE       FALSE   
#&gt;  6 OOA6    155     1741149       5     336     667.     343. TRUE       FALSE   
#&gt;  7 OOA7    156     1802798       6     337     664.     302. TRUE       FALSE   
#&gt;  8 OOA8    157     1863882       7     338     647.     319. TRUE       FALSE   
#&gt;  9 OOA9    158     1921961       8     339     673.     317. TRUE       FALSE   
#&gt; 10 OOA10   159     1983165       9     340     672.     319. TRUE       FALSE   
#&gt; # … with 321 more rows, and 7 more variables: alive &lt;lgl&gt;, pop_id &lt;int&gt;,
#&gt; #   flag &lt;int&gt;, pop &lt;chr&gt;, time &lt;int&gt;, chr1 &lt;chr&gt;, chr2 &lt;chr&gt;</code></pre>
<p>However, in order to perform spatiotemporal data analysis, we would like to have the data presented in a format suitable for spatial analyses.</p>
<p>We can extract all location information from the tree-sequence object with a function <code><a href="../reference/ts_spatial.html">ts_spatial()</a></code>. Without any other argument it simply extract all locations data for individuals present in the tree-sequence. As with all other <em>slendr</em> objects, the returned object is of the class <code>slendr_spatial</code> but is actually internally stored as an <code>sf</code> object. As we will see below, this means that we can use all the functionality of the powerful <em>simple features</em> <a href="https://r-spatial.github.io/sf/">R package <em>sf</em></a> for plotting, manipulation, and statistical analysis. For now, typing the object into the R console presents a user-friendly summary of the spatiotemporal data extracted from the tree-sequence:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_spatial.html">ts_spatial</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span>
<span class="va">ts_sf</span></code></pre></div>
<pre><code>#&gt; slendr 'spatial' object 
#&gt; ----------------------- 
#&gt; spatial tree-sequence contents:
#&gt;   AFR - 50 individuals
#&gt;   ANA - 48 individuals
#&gt;   EHG - 44 individuals
#&gt;   EUR - 149 individuals
#&gt;   OOA - 31 individuals
#&gt;   YAM - 9 individuals
#&gt; 
#&gt;   oldest sample:  40000 
#&gt;   youngest sample:  0 
#&gt; 
#&gt; map: internal coordinate reference system: EPSG 3035 
#&gt; spatial limits (in degrees longitude and latitude):
#&gt;   - vertical -15 ... 60
#&gt;   - horizontal 20 ... 65
#&gt; 
#&gt; contents of the sf object:
#&gt; 
#&gt; # A tibble: 331 x 17
#&gt;    name   time          location    id chr1_id chr2_id pedigree_id
#&gt;    &lt;chr&gt; &lt;int&gt;       &lt;POINT [m]&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;       &lt;int&gt;
#&gt;  1 OOA1  40000 (8078129 2848011)   150       0     331     1441668
#&gt;  2 OOA2  39500 (8115548 2891034)   151       1     332     1502890
#&gt;  3 OOA3  39000 (8516962 3465288)   152       2     333     1560347
#&gt;  4 OOA4  38500 (8082480 3379350)   153       3     334     1622207
#&gt;  5 OOA5  38000 (8487390 3240527)   154       4     335     1683493
#&gt;  6 OOA6  37500 (8312391 3543309)   155       5     336     1741149
#&gt;  7 OOA7  37000 (8284496 3137243)   156       6     337     1802798
#&gt;  8 OOA8  36500 (8107185 3299701)   157       7     338     1863882
#&gt;  9 OOA9  36000 (8373710 3284231)   158       8     339     1921961
#&gt; 10 OOA10 35500 (8355882 3302481)   159       9     340     1983165
#&gt; # … with 321 more rows, and 10 more variables: remembered &lt;lgl&gt;,
#&gt; #   retained &lt;lgl&gt;, alive &lt;lgl&gt;, raster_x &lt;dbl&gt;, raster_y &lt;dbl&gt;, pop_id &lt;int&gt;,
#&gt; #   flag &lt;int&gt;, pop &lt;chr&gt;, chr1 &lt;chr&gt;, chr2 &lt;chr&gt;</code></pre>
<p>At this point, it is important to mention that by default, if a <em>slendr</em> model which generated the tree-sequence was encoded in a projected <a href="https://keen-swartz-3146c4.netlify.app/intro.html#coordinate-reference-systems">Coordinate Reference System</a>, <code><a href="../reference/ts_spatial.html">ts_spatial()</a></code> automatically transforms coordinates from pixel-based raster coordinates used internally by SLiM (which is stored as <code>raster_x</code> and <code>raster_y</code> columns in data returned by the <code><a href="../reference/ts_individuals.html">ts_individuals()</a></code> function) into that projected CRS. We can override this behavior by specifying an argument <code>crs</code>. For instance, if we wanted to convert coordinates to the widely used <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">World Geodetic System (WGS 84)</a> which encodes coordinates in the global coordinate system (degrees longitude and latitude), we could run:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts_sf_wgs84</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_spatial.html">ts_spatial</a></span><span class="op">(</span><span class="va">ts</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span>
<span class="va">ts_sf_wgs84</span></code></pre></div>
<pre><code>#&gt; slendr 'spatial' object 
#&gt; ----------------------- 
#&gt; spatial tree-sequence contents:
#&gt;   AFR - 50 individuals
#&gt;   ANA - 48 individuals
#&gt;   EHG - 44 individuals
#&gt;   EUR - 149 individuals
#&gt;   OOA - 31 individuals
#&gt;   YAM - 9 individuals
#&gt; 
#&gt;   oldest sample:  40000 
#&gt;   youngest sample:  0 
#&gt; 
#&gt; map: internal coordinate reference system: EPSG 3035 
#&gt; spatial limits (in degrees longitude and latitude):
#&gt;   - vertical -15 ... 60
#&gt;   - horizontal 20 ... 65
#&gt; 
#&gt; contents of the sf object:
#&gt; 
#&gt; # A tibble: 331 x 17
#&gt;    name   time            location    id chr1_id chr2_id pedigree_id
#&gt;    &lt;chr&gt; &lt;int&gt;         &lt;POINT [°]&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;       &lt;int&gt;
#&gt;  1 OOA1  40000 (55.57624 38.09138)   150       0     331     1441668
#&gt;  2 OOA2  39500 (56.20279 38.20475)   151       1     332     1502890
#&gt;  3 OOA3  39000  (63.89272 39.8387)   152       2     333     1560347
#&gt;  4 OOA4  38500 (59.02694 41.81637)   153       3     334     1622207
#&gt;  5 OOA5  38000  (62.04396 38.5424)   154       4     335     1683493
#&gt;  6 OOA6  37500 (62.48786 41.58139)   155       5     336     1741149
#&gt;  7 OOA7  37000 (59.40316 39.01447)   156       6     337     1802798
#&gt;  8 OOA8  36500 (58.72855 41.13011)   157       7     338     1863882
#&gt;  9 OOA9  36000    (61.25 39.50242)   158       8     339     1921961
#&gt; 10 OOA10 35500 (61.20213 39.72891)   159       9     340     1983165
#&gt; # … with 321 more rows, and 10 more variables: remembered &lt;lgl&gt;,
#&gt; #   retained &lt;lgl&gt;, alive &lt;lgl&gt;, raster_x &lt;dbl&gt;, raster_y &lt;dbl&gt;, pop_id &lt;int&gt;,
#&gt; #   flag &lt;int&gt;, pop &lt;chr&gt;, chr1 &lt;chr&gt;, chr2 &lt;chr&gt;</code></pre>
<p>Note that the location column of the spatial data object now says <code>&lt;POINT [°]&gt;</code>, indicating that the coordinates are in longitudinal and latitudinal degrees.</p>
<p>We have to keep in mind, however, that we specified the world map of our model to be represented in projected CRS (EPSG 3035) internally, so plotting the locations data in degrees longitude and latitude onto this map projection would require an <a href="https://r-spatial.github.io/sf/reference/st_transform.html">explicit transformation</a> (which is why <code><a href="../reference/ts_spatial.html">ts_spatial()</a></code> by default converts coordinates into the model’s own CRS):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map</span></code></pre></div>
<pre><code>#&gt; slendr 'map' object 
#&gt; ------------------- 
#&gt; map: internal coordinate reference system: EPSG 3035 
#&gt; spatial limits (in degrees longitude and latitude):
#&gt;   - vertical -15 ... 60
#&gt;   - horizontal 20 ... 65</code></pre>
</div>
<div id="using-the-simple-features-interface" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-simple-features-interface" class="anchor"></a>Using the <em>simple features</em> interface</h2>
<p>It’s hard to overstate how powerful the library for manipulating <em>simple features</em> of the class <code>sf</code> is. However, it is equally hard to really see this power, especially for novice spatial data analysts which is already quite a challenging field to get into because of many new concepts and names (<a href="https://www.esri.com/arcgis-blog/products/arcgis-pro/mapping/coordinate-systems-difference/#GCS">“projected” vs “geographic” Coordinate Reference Systems</a>, transformations between them, their interaction with the <em>ggplot2</em> library for plotting, etc.). A lot of the <em>slendr</em> conveniences for encoding and programming spatial models, as well as its features for loading and accessing tree-sequence data, are designed to abstract away most of the complexities of the underlying low-level details to let you focus on the problem at hand.</p>
<p>Unfortunately, once you generate spatial genomic data, it is almost impossible for us to cover the complexities of data analysis and so it is expected that you will have to learn the basics of handling spatio-temporal data yourself. Luckily, everything that you simulated is no different from any other source of spatial data out there and you have <a href="https://r-spatial.github.io/sf/">tremendous</a> free <a href="https://keen-swartz-3146c4.netlify.app">resources</a> at your disposal.</p>
<p>The bottom line is: the spatio-temporal data extracted from tree-sequences by the <code><a href="../reference/ts_spatial.html">ts_spatial()</a></code> function is nothing else than a normal <a href="https://r-spatial.github.io/sf/"><code>sf</code></a> data. Any resource that you find for manipulating, plotting, and analysing <code>sf</code> data can be applied here as well.</p>
</div>
<div id="plotting-simulated-spatio-temporal-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-simulated-spatio-temporal-samples" class="anchor"></a>Plotting simulated spatio-temporal samples</h2>
<p>Recall that our own function <code>plot.slendr</code> makes it possible to plot any <em>slendr</em> object on a world map. For instance, we can plot the world map itself simply by calling:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-06-locations_files/figure-html/world_map-1.png" width="672"></p>
<p>Internally, this function is implemented using <em>ggplot2</em> and the <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> function for <a href="https://r-spatial.github.io/sf/articles/sf5.html">plotting <em>sf</em> spatial features</a>. This means that it simply returns a <code>ggplot</code> object, which is automatically plotted on evaluation:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">class</span></code></pre></div>
<pre><code>#&gt; [1] "gg"     "ggplot"</code></pre>
<p>The consequence of the power of <em>ggplot2</em> and <em>sf</em> libraries is that we can overlay other <em>sf</em> features on top of this, including the data extracted and converted by our own <code><a href="../reference/ts_spatial.html">ts_spatial()</a></code> function!</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/ts_spatial.html">ts_spatial</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Locations of simulated sampled individuals"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
<p><img src="vignette-06-locations_files/figure-html/slendr_map_ts-1.png" width="672"></p>
<p>Because internally, <code>sf</code> <em>simple features</em> (and, by extension, even <code>slendr_spatial</code> objects) are stored as <a href="https://r-spatial.github.io/sf/articles/sf1.html#how-simple-features-in-r-are-organized">normal data frames</a> with couple more bells and whistles on top of them, we have all the <a href="https://www.tidyverse.org">magnificent tools</a> for manipulating tabular data at our disposal.</p>
<p>As an example, let’s say we wanted to split the sampled individuals in the tree-sequence into epochs and plot those individually using standard <em>ggplot2</em> features. We could simply first do this, adding a new column specifying to which epoch does a simulated individual belong:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts_sf</span> <span class="op">&lt;-</span> <span class="va">ts_sf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epoch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">time</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">30000</span>, <span class="fl">10000</span>, <span class="fl">4000</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         epoch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">epoch</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">epoch</span><span class="op">)</span>,
         epoch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">epoch</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"present"</span>, <span class="st">"(present, 4 ky]"</span>, <span class="st">"(4 ky, 10 ky]"</span>,
                                          <span class="st">"(10 ky, 30 y]"</span>, <span class="st">"(30 ky, 40 ky]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">ts_sf</span></code></pre></div>
<pre><code>#&gt; Simple feature collection with 331 features and 17 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 2583104 ymin: 298236.2 xmax: 8516962 ymax: 4862161
#&gt; Projected CRS: ETRS89-extended / LAEA Europe
#&gt; slendr 'spatial' object 
#&gt; ----------------------- 
#&gt; spatial tree-sequence contents:
#&gt;   AFR - 50 individuals
#&gt;   ANA - 48 individuals
#&gt;   EHG - 44 individuals
#&gt;   EUR - 149 individuals
#&gt;   OOA - 31 individuals
#&gt;   YAM - 9 individuals
#&gt; 
#&gt;   oldest sample:  40000 
#&gt;   youngest sample:  0 
#&gt; 
#&gt; map: internal coordinate reference system: EPSG 3035 
#&gt; spatial limits (in degrees longitude and latitude):
#&gt;   - vertical -15 ... 60
#&gt;   - horizontal 20 ... 65
#&gt; 
#&gt; contents of the sf object:
#&gt; 
#&gt; # A tibble: 331 x 18
#&gt;    name   time          location    id chr1_id chr2_id pedigree_id
#&gt;    &lt;chr&gt; &lt;int&gt;       &lt;POINT [m]&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;       &lt;int&gt;
#&gt;  1 OOA1  40000 (8078129 2848011)   150       0     331     1441668
#&gt;  2 OOA2  39500 (8115548 2891034)   151       1     332     1502890
#&gt;  3 OOA3  39000 (8516962 3465288)   152       2     333     1560347
#&gt;  4 OOA4  38500 (8082480 3379350)   153       3     334     1622207
#&gt;  5 OOA5  38000 (8487390 3240527)   154       4     335     1683493
#&gt;  6 OOA6  37500 (8312391 3543309)   155       5     336     1741149
#&gt;  7 OOA7  37000 (8284496 3137243)   156       6     337     1802798
#&gt;  8 OOA8  36500 (8107185 3299701)   157       7     338     1863882
#&gt;  9 OOA9  36000 (8373710 3284231)   158       8     339     1921961
#&gt; 10 OOA10 35500 (8355882 3302481)   159       9     340     1983165
#&gt; # … with 321 more rows, and 11 more variables: remembered &lt;lgl&gt;,
#&gt; #   retained &lt;lgl&gt;, alive &lt;lgl&gt;, raster_x &lt;dbl&gt;, raster_y &lt;dbl&gt;, pop_id &lt;int&gt;,
#&gt; #   flag &lt;int&gt;, pop &lt;chr&gt;, chr1 &lt;chr&gt;, chr2 &lt;chr&gt;, epoch &lt;fct&gt;</code></pre>
<p>Note the new column <code>epoch</code> in the printed summary above.</p>
<p>Then, because the <code>slendr_spatial</code> object is internally stored as a <code>sf</code> object, we can use the <em>ggplot2</em> function <code>geom_sf</code> to plot it on the map (the warning can be safely ignored):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">world</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ts_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">pop</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">epoch</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Locations of simulated sampled individuals"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
<p><img src="vignette-06-locations_files/figure-html/slendr_map_epochs-1.png" width="672"></p>
<p>We mentioned that the <em>slendr</em> function <code><a href="../reference/plot.slendr.html">plot.slendr()</a></code> is implemented using <em>ggplot2</em> and <em>sf</em> R packages. The implementation of the function is rather complex because it is a generic function designed to take various sorts of input data (remember that you can use it to plot the world map, <em>slendr</em> regions, and populations themselves). However, in the interest of making it clear that everything that <em>slendr</em> does is completely transparent and that every <em>slendr</em> spatial object of any kind is implemented as an <em>sf</em> object internally, here is how you could create the previous plot without using any <em>slendr</em> plotting functionality at all:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">map</span>, fill <span class="op">=</span> <span class="st">"lightgray"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> <span class="co"># plot the map</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ts_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">pop</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.75</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> <span class="co"># plot tree-sequence locations</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="co"># fill in the map features to the edges</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">epoch</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Locations of simulated sampled individuals"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-06-locations_files/figure-html/ggplot_map_epochs-1.png" width="672"></p>
<p>This is why, although it is impossible for us to capture every possible type of figure you might want to create for your study, you can easily use your knowledge of <em>ggplot2</em> to make any figure imaginable.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martin Petr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'a895c93f0e9eda05eb10b29a9921d586',
    indexName: 'slendr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
