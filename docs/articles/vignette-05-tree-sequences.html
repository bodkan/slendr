<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tree-sequence processing and statistics • slendr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Tree-sequence processing and statistics">
<meta property="og:description" content="slendr">
<meta property="og:image" content="https://www.slendr.net/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slendr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-question-circle"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette-00-installation.html">Installation instructions</a>
    </li>
    <li>
      <a href="../articles/vignette-01-tutorial.html">Introduction and basic tutorial</a>
    </li>
    <li>
      <a href="../articles/vignette-02-grid-model.html">Demes on a regular spatial grid</a>
    </li>
    <li>
      <a href="../articles/vignette-03-interactions.html">Programming dispersion dynamics</a>
    </li>
    <li>
      <a href="../articles/vignette-04-nonspatial-models.html">Traditional non-spatial models</a>
    </li>
    <li>
      <a href="../articles/vignette-05-tree-sequences.html">Tree sequence processing and statistics</a>
    </li>
    <li>
      <a href="../articles/vignette-06-locations.html">Spatially annotated tree sequences</a>
    </li>
    <li>
      <a href="../articles/vignette-07-backends.html">Simulating data with SLiM and msprime backends</a>
    </li>
    <li>
      <a href="../articles/vignette-08-paper.html">Examples from the slendr paper</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bodkan/slendr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/dr_bodkan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tree-sequence processing and statistics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bodkan/slendr/blob/HEAD/vignettes/vignette-05-tree-sequences.Rmd" class="external-link"><code>vignettes/vignette-05-tree-sequences.Rmd</code></a></small>
      <div class="hidden name"><code>vignette-05-tree-sequences.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we will show how to specify sampling events to record individuals in the tree-sequence output file (a procedure which is called “remembering” of individuals in the SLiM context) and how to perform simple analyses using <em>slendr</em>’s interface to the <a href="https://tskit.dev" class="external-link"><em>tskit</em></a> Python library. We will demonstrate these features on a simulation of Neanderthal introgression into anatomically modern humans. Specifically, we will show how to estimate the amount of Neanderthal ancestry using <span class="math inline">\(f\)</span>-statistics calculated directly on the tree-sequence data structure generated by a <em>slendr</em> model, all entirely from R.</p>
<div class="section level3">
<h3 id="model-of-neanderthal-introgression-into-eurasians">Model of Neanderthal introgression into Eurasians<a class="anchor" aria-label="anchor" href="#model-of-neanderthal-introgression-into-eurasians"></a>
</h3>
<p>First, let’s set up a simple <em>non-spatial</em> model of Neanderthal introgression using <em>slendr.</em> This is essentially the same procedure which we have shown in another vignette introducing <a href="vignette-04-nonspatial-models.html">non-spatial <em>slendr</em> models</a>. This is no different from a spatial model, except that we left out the <code>map</code> argument in calling <code><a href="../reference/population.html">population()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bodkan/slendr" class="external-link">slendr</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; The interface to all required Python modules has been activated.</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span></code></pre>
<pre><code><span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span></code></pre>
<pre><code><span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">314159</span><span class="op">)</span>

<span class="co"># create the ancestor of everyone and a chimpanzee outgroup</span>
<span class="co"># (we set both N = 1 to reduce the computational time for this model)</span>
<span class="va">chimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span><span class="st">"CH"</span>, time <span class="op">=</span> <span class="fl">6.5e6</span>, N <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="co"># two populations of anatomically modern humans: Africans and Europeans</span>
<span class="va">afr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span><span class="st">"AFR"</span>, parent <span class="op">=</span> <span class="va">chimp</span>, time <span class="op">=</span> <span class="fl">6e6</span>, N <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>
<span class="va">eur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span><span class="st">"EUR"</span>, parent <span class="op">=</span> <span class="va">afr</span>, time <span class="op">=</span> <span class="fl">70e3</span>, N <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>

<span class="co"># Neanderthal population splitting at 600 ky ago from modern humans</span>
<span class="co"># (becomes extinct by 40 ky ago)</span>
<span class="va">nea</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span><span class="st">"NEA"</span>, parent <span class="op">=</span> <span class="va">afr</span>, time <span class="op">=</span> <span class="fl">600e3</span>, N <span class="op">=</span> <span class="fl">1000</span>, remove <span class="op">=</span> <span class="fl">40e3</span><span class="op">)</span>

<span class="co"># 3% Neanderthal introgression into Europeans between 55-50 ky ago</span>
<span class="va">gf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gene_flow.html">gene_flow</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">nea</span>, to <span class="op">=</span> <span class="va">eur</span>, rate <span class="op">=</span> <span class="fl">0.03</span>, start <span class="op">=</span> <span class="fl">55000</span>, end <span class="op">=</span> <span class="fl">45000</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compile_model.html">compile_model</a></span><span class="op">(</span>
  populations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">chimp</span>, <span class="va">nea</span>, <span class="va">afr</span>, <span class="va">eur</span><span class="op">)</span>, gene_flow <span class="op">=</span> <span class="va">gf</span>,
  generation_time <span class="op">=</span> <span class="fl">30</span>,
  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"_introgression"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Here’s our toy model visualized as a “demographic graph” of sorts (i.e., a tree-like structure specifying population splits with additional edges representing gene flow events). Not particularly illuminating in this simple example, but it’s always worth keeping in mind that such graph is embedded within every <em>slendr</em> model and can be always invoked to make sure the model you’re setting up is correct:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/plot_model.html">plot_model</a></span><span class="op">(</span><span class="va">model</span>, sizes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/plot_model.html">plot_model</a></span><span class="op">(</span><span class="va">model</span>, sizes <span class="op">=</span> <span class="cn">FALSE</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  nrow <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span></code></pre></div>
<p><img src="vignette-05-tree-sequences_files/figure-html/introgression_graph-1.png" width="640"></p>
</div>
<div class="section level2">
<h2 id="scheduling-of-sampling-events">Scheduling of sampling events<a class="anchor" aria-label="anchor" href="#scheduling-of-sampling-events"></a>
</h2>
<p>Now that we have defined a model, how do we sample data from it? Ideally, we would like to to schedule sampling events at a given time, sampling a defined number of individuals from a given population. This is why <em>slendr</em> provides a function <code><a href="../reference/schedule_sampling.html">schedule_sampling()</a></code> which serves to define such sampling schedule automatically and enforces that only populations which are already (i.e. after their appearance in the simulation) or still (before they are removed from the simulation) present will be sampled from.</p>
<p>In our example, we want to sample two Neanderthal individuals (the older one being the <a href="https://www.nature.com/articles/nature12886" class="external-link">Altai Neanderthal</a>, the younger one <a href="https://www.science.org/doi/10.1126/science.aao1887" class="external-link">Vindija Neanderthal</a>). These two genomes are what we <a href="https://www.pnas.org/content/116/5/1639" class="external-link">need</a> to estimate Neanderthal ancestry proportion using a so-called <span class="math inline">\(f_4\)</span>-ratio statistic (more on that below):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nea_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schedule_sampling.html">schedule_sampling</a></span><span class="op">(</span><span class="va">model</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70000</span>, <span class="fl">40000</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">nea</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">nea_samples</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span>
<span class="co">#&gt;    time pop       n y_orig x_orig y     x    </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">40</span>000 NEA       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">70</span>000 NEA       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></code></pre>
<p>As you can see, the <code><a href="../reference/schedule_sampling.html">schedule_sampling()</a></code> function simply accepts the vector of times at which remembering should be schedule, and then a list of pairs <code>(&lt;slendr population&gt;, &lt;number of individuals&gt;)</code> encoding from which populations should how many individuals be remembered at time points given in the <code>times</code> vector.</p>
<p>Next, we want to sample some present-day individuals: an outgroup representing a chimpanzee, and a couple of Africans and Europeans:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">present_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schedule_sampling.html">schedule_sampling</a></span><span class="op">(</span><span class="va">model</span>, times <span class="op">=</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">chimp</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">afr</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eur</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">present_samples</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span>
<span class="co">#&gt;    time pop       n y_orig x_orig y     x    </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 CH        1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     0 AFR       5 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     0 EUR      10 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></code></pre>
<p>As you can see above, the <code><a href="../reference/schedule_sampling.html">schedule_sampling()</a></code> function returns a plain old data frame with a very simple structure with three columns: time, population name, and the number of individuals. This means that you can define sampling events using whatever input data you might already have available (such as radiocarbon-dated ancient DNA samples from an Excel sheet from some publication). For instance, there has been a <a href="https://www.nature.com/articles/nature17993" class="external-link">lot</a> of <a href="https://www.pnas.org/content/116/5/1639" class="external-link">interest</a> to estimate the trajectory of Neanderthal ancestry in Europe over time using ancient DNA data from anatomically modern human individuals (also called early modern humans, EMH) across the last couple of tens of thousands of years. We can simulate something close to the available <a href="https://www.nature.com/articles/nature17993" class="external-link">EMH ancient DNA data set</a> over the last 50 thousand years by running doing this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">emh_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schedule_sampling.html">schedule_sampling</a></span><span class="op">(</span><span class="va">model</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">40</span>, min <span class="op">=</span> <span class="fl">10000</span>, max <span class="op">=</span> <span class="fl">40000</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eur</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">emh_samples</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 7</span></span>
<span class="co">#&gt;     time pop       n y_orig x_orig y     x    </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="text-decoration: underline;">10</span>319 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="text-decoration: underline;">11</span>187 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="text-decoration: underline;">11</span>395 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="text-decoration: underline;">11</span>529 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="text-decoration: underline;">11</span>927 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="text-decoration: underline;">12</span>675 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="text-decoration: underline;">13</span>689 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="text-decoration: underline;">13</span>744 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="text-decoration: underline;">14</span>774 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="text-decoration: underline;">16</span>361 EUR       1 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 30 more rows</span></span></code></pre>
<p>This samples a single ancient European individuals at randomly chosen times between 40 and 10 ky ago.</p>
<p>One nice feature of the <code><a href="../reference/schedule_sampling.html">schedule_sampling()</a></code> function is that it only schedules sampling events for a population, if that population is present in the simulation at a given time. This makes it possible to simply take a wide time range for sampling, specify all populations and sizes of the samples, and let the function generate sampling events only for populations present at each time. If for some reason a stricter control over sampling is required, this behavior can be switched off by setting <code>strict = TRUE</code> like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this attempts to sample a Neanderthal individual at a point when Neanderthals</span>
<span class="co"># are already extinct, resulting in an error</span>
<span class="fu"><a href="../reference/schedule_sampling.html">schedule_sampling</a></span><span class="op">(</span><span class="va">model</span>, times <span class="op">=</span> <span class="fl">10000</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">nea</span>, <span class="fl">1</span><span class="op">)</span>, strict <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>Error: Cannot schedule sampling for 'NEA' at time 10000 because the population will not be present in the simulation at that point. Consider running this function with `strict = FALSE` which will automatically retain only valid sampling events.</code></pre>
<p>Now that we already have the <code>model</code> object ready, we can simulate data from it, sampling individuals according to our sampling schedule. Although we could use the <code><a href="../reference/slim.html">slim()</a></code> function shown in previous vignettes, in this case we will run the simulation with the <code><a href="../reference/msprime.html">msprime()</a></code> coalescent back end. After all, our model is non-spatial and using a coalescent simulator will be much more efficient than the forward simulation. Switching between the msprime and SLiM back ends of slendr is demonstrated in much more detail in a <a href="vignette-07-backends.html">dedicated vignette</a>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/msprime.html">msprime</a></span><span class="op">(</span>
  <span class="va">model</span>, sequence_length <span class="op">=</span> <span class="fl">100e6</span>, recombination_rate <span class="op">=</span> <span class="fl">1e-8</span>,
  sampling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">nea_samples</span>, <span class="va">present_samples</span>, <span class="va">emh_samples</span><span class="op">)</span>,
  random_seed <span class="op">=</span> <span class="fl">314159</span>
<span class="op">)</span></code></pre></div>
<p>Note that we bind the individual sampling schedule data frames using the <code>rbind</code> function provided by base R (as we show above, the sampling schedule really is just a data frame and we can manipulate it as such).</p>
</div>
<div class="section level2">
<h2 id="r-interface-for-tskit-and-pyslim">R interface for <em>tskit</em> and <em>pyslim</em><a class="anchor" aria-label="anchor" href="#r-interface-for-tskit-and-pyslim"></a>
</h2>
<p>When we execute the model, <em>slendr</em> will instruct the simulation back end script to save the output of the simulation as a tree sequence file. By default, the file is stored in the model directory:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">path</span>, <span class="st">"output_msprime.trees"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">ts_file</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; [1] TRUE</span></code></pre>
<p>Tree-sequences are one of the most revolutionary developments in population genetics in the last couple of decades for a number of reasons. One of them is the possibility to store extremely large data sets succinctly by encoding the entire evolutionary history of a sample of individuals as a series of correlated tree genealogies along the genome.</p>
<p>Going into too much detail on this topic is clearly beyond the scope of this tutorial, especially because everything is explain much better <a href="https://tskit.dev/learn.html" class="external-link">elsewhere</a>. Instead, what we will demonstrate in the rest of this vignette is how you can access and manipulate tree-sequence outputs generated by <em>slendr</em> models and perform various statistics on them using Python modules <a href="https://tskit.dev/tskit/docs/stable/" class="external-link"><em>tskit</em></a> and <a href="https://pyslim.readthedocs.io/en/latest/index.html" class="external-link"><em>pyslim</em></a> directly from <em>slendr,</em> without having to leave R! The key is a magical R package <a href="https://rstudio.github.io/reticulate/index.html" class="external-link"><em>reticulate</em></a> which creates a seamless binding of Python modules with R. This means that even if you don’t know Python, <em>slendr</em> allows you to do do quite a lot with tree-sequences in R.</p>
<p>Of course, if you are a proficient Python user, it needs to be said that once you have the tree-sequence file generated by <em>slendr</em> &amp; SLiM, you can easily perform every conceivable analysis directly using <em>tskit</em>. The intention here is to show how you can continue working on the tree-sequence files in R even after you have run the entire <em>slendr</em> simulation.</p>
</div>
<div class="section level2">
<h2 id="setting-up-python-environment">Setting up Python environment<a class="anchor" aria-label="anchor" href="#setting-up-python-environment"></a>
</h2>
<p>First, in order to be able to interface with <em>tskit</em> and <em>pyslim</em> using the <em>reticulate</em> package, you will need a working Python environment with the required Python modules <code>pyslim</code>, <code>tskit</code> and <code>msprime</code> already installed.</p>
<p>Because setting up Python environments can be quite a <a href="https://xkcd.com/1987/" class="external-link">hassle</a>, <em>slendr</em> provides a single function <code><a href="../reference/setup_env.html">setup_env()</a></code> to make things easier. If you call it without any arguments, <em>slendr</em> will automatically download, install, and setup a <strong>completely separate</strong> Python environment (based on the “miniconda” distribution) just for <em>slendr</em> and activate it in the background. Even if you’re an advanced Python user, I recommend going through this route because it will make sure that all dependencies are at their right versions that have been tested in <em>slendr</em>.</p>
<p>A couple of notes:</p>
<ul>
<li><p>It is important to stress that <code><a href="../reference/setup_env.html">setup_env()</a></code> will not interfere in any way with any of the Python installations you might already have on your computer. The Python installation and environment will be entirely isolated and used just for the purpose of <em>slendr</em> workflows.</p></li>
<li><p>If you insist on managing your own Python environment, that’s OK too. Take a look at <a href="https://CRAN.R-project.org/package=reticulate/vignettes/versions.html" class="external-link">this guide</a>. You will be interested in the function <code>reticulate::user_virtualenv()</code> or <code><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">reticulate::use_condaenv()</a></code> which is what our own <code><a href="../reference/setup_env.html">setup_env()</a></code> uses under the hood. You will need and environment at least Python version 3.9 or higher, with <em>tskit</em> 0.4.1, <em>msprime</em> 1.1.0, <em>pyslim</em> 0.700, and for running the <em>msprime</em> back end script of <em>slendr</em> also pandas 1.3.5. Higher versions might also work, but those exact versions is what <em>slendr</em> is being developed and tested on.</p></li>
</ul>
<p>With all that introduction out of the way, let’s now activate the <em>slendr</em> Python environment (potentially installing it if it’s not present yet):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/setup_env.html">setup_env</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; The interface to all required Python modules has been activated.</span></code></pre>
<p>We can use another built-in function <code><a href="../reference/check_env.html">check_env()</a></code> to make sure that <em>slendr</em> installed and configured the correct environment for us:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/check_env.html">check_env</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; Summary of the currently active Python environment:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Python binary: /Users/martin_petr/Library/r-miniconda/envs/slendr_msprime-1.1.1_tskit-0.4.1_pyslim-0.700_pandas/bin/python </span>
<span class="co">#&gt; Python version: 3.8.12 | packaged by conda-forge | (default, Jan 30 2022, 23:36:06)  [Clang 11.1.0 ] </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; slendr requirements:</span>
<span class="co">#&gt;  - tskit: version 0.4.1 ✓ </span>
<span class="co">#&gt;  - msprime: version 1.1.1 ✓ </span>
<span class="co">#&gt;  - pyslim: version 0.700 ✓</span></code></pre>
<p>Now we’re good to go and ready to analyse tree sequence outputs in R!</p>
</div>
<div class="section level2">
<h2 id="loading-and-processing-tree-sequence-output-files">Loading and processing tree-sequence output files<a class="anchor" aria-label="anchor" href="#loading-and-processing-tree-sequence-output-files"></a>
</h2>
<p>With the technicalities out of the way, we can now load the tree-sequence file saved by the simulation using the <em>slendr</em> function <code><a href="../reference/ts_load.html">ts_load()</a></code>. If we’re dealing with a tree sequence produced by the SLiM back end (which is not the case here), we can also instruct this function to simplify the tree-sequence to only the individuals that we explicitly sampled (recall the sampling schedule we set up with the <code><a href="../reference/schedule_sampling.html">schedule_sampling()</a></code> function above). Note that we have to provide the <code>model</code> object generated by <code><a href="../reference/compile_model.html">compile_model()</a></code> above in order to have all model annotation information for the simulated tree-sequence data (we have to do this only once, and only during loading):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_load.html">ts_load</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="va">ts</span></code></pre></div>
<pre><code><span class="co">#&gt; ╔═══════════════════════════╗</span>
<span class="co">#&gt; ║TreeSequence               ║</span>
<span class="co">#&gt; ╠═══════════════╤═══════════╣</span>
<span class="co">#&gt; ║Trees          │     237352║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sequence Length│  100000000║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Time Units     │generations║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sample Nodes   │        116║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Total Size     │   36.4 MiB║</span>
<span class="co">#&gt; ╚═══════════════╧═══════════╝</span>
<span class="co">#&gt; ╔═══════════╤══════╤═════════╤════════════╗</span>
<span class="co">#&gt; ║Table      │Rows  │Size     │Has Metadata║</span>
<span class="co">#&gt; ╠═══════════╪══════╪═════════╪════════════╣</span>
<span class="co">#&gt; ║Edges      │858165│ 26.2 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Individuals│    58│  1.6 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Migrations │     0│  8 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Mutations  │     0│ 16 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Nodes      │138217│  3.7 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Populations│     4│338 Bytes│         Yes║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Provenances│     1│  7.0 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Sites      │     0│ 16 Bytes│          No║</span>
<span class="co">#&gt; ╚═══════════╧══════╧═════════╧════════════╝</span></code></pre>
<p>If we try to simplify an <em>msprime</em>-generated tree sequence, we get a warning. This is because such tree sequence is already in a simplified form, by definition coming from a coalescent simulator.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_load.html">ts_load</a></span><span class="op">(</span><span class="va">model</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; Warning: If you want to simplify an msprime tree sequence, you must specify</span>
<span class="co">#&gt; the names of individuals to simplify to via the `simplify_to = `</span>
<span class="co">#&gt; function argument.</span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span></code></pre></div>
<pre><code><span class="co">#&gt; ╔═══════════════════════════╗</span>
<span class="co">#&gt; ║TreeSequence               ║</span>
<span class="co">#&gt; ╠═══════════════╤═══════════╣</span>
<span class="co">#&gt; ║Trees          │     237352║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sequence Length│  100000000║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Time Units     │generations║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sample Nodes   │        116║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Total Size     │   36.4 MiB║</span>
<span class="co">#&gt; ╚═══════════════╧═══════════╝</span>
<span class="co">#&gt; ╔═══════════╤══════╤═════════╤════════════╗</span>
<span class="co">#&gt; ║Table      │Rows  │Size     │Has Metadata║</span>
<span class="co">#&gt; ╠═══════════╪══════╪═════════╪════════════╣</span>
<span class="co">#&gt; ║Edges      │858165│ 26.2 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Individuals│    58│  1.6 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Migrations │     0│  8 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Mutations  │     0│ 16 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Nodes      │138217│  3.7 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Populations│     4│338 Bytes│         Yes║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Provenances│     1│  7.0 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Sites      │     0│ 16 Bytes│          No║</span>
<span class="co">#&gt; ╚═══════════╧══════╧═════════╧════════════╝</span></code></pre>
<p>By default, simplification in <code><a href="../reference/ts_load.html">ts_load()</a></code> simplified the tree-sequence down to only remembered individuals (i.e. those we explicitly scheduled for sampling), which is true for every <em>msprime</em> tree sequence.</p>
<p>Alternatively, we can also narrow down the simplification to a defined set of individuals using the <code>simplify_to =</code> argument. Internally, simplification is implemented in a dedicated function <code><a href="../reference/ts_simplify.html">ts_simplify()</a></code> which we can always call explicitly, like this:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_simplify.html">ts_simplify</a></span><span class="op">(</span><span class="va">ts</span>, simplify_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CH_1"</span>, <span class="st">"NEA_1"</span>, <span class="st">"NEA_2"</span>, <span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"EUR_20"</span>, <span class="st">"EUR_50"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ts_small</span></code></pre></div>
<pre><code><span class="co">#&gt; ╔═══════════════════════════╗</span>
<span class="co">#&gt; ║TreeSequence               ║</span>
<span class="co">#&gt; ╠═══════════════╤═══════════╣</span>
<span class="co">#&gt; ║Trees          │     131740║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sequence Length│  100000000║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Time Units     │generations║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sample Nodes   │         14║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Total Size     │   18.8 MiB║</span>
<span class="co">#&gt; ╚═══════════════╧═══════════╝</span>
<span class="co">#&gt; ╔═══════════╤══════╤═════════╤════════════╗</span>
<span class="co">#&gt; ║Table      │Rows  │Size     │Has Metadata║</span>
<span class="co">#&gt; ╠═══════════╪══════╪═════════╪════════════╣</span>
<span class="co">#&gt; ║Edges      │436892│ 13.3 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Individuals│     7│220 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Migrations │     0│  8 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Mutations  │     0│ 16 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Nodes      │ 78560│  2.1 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Populations│     4│338 Bytes│         Yes║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Provenances│     2│  7.5 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Sites      │     0│ 16 Bytes│          No║</span>
<span class="co">#&gt; ╚═══════════╧══════╧═════════╧════════════╝</span></code></pre>
<p>Similarly, <em>slendr</em> provides a function <code><a href="../reference/ts_recapitate.html">ts_recapitate()</a></code> which performs [recapitation]<a href="https://tskit.dev/pyslim/docs/latest/tutorial.html#recapitation" class="external-link uri">https://tskit.dev/pyslim/docs/latest/tutorial.html#recapitation</a>). Again, this is not needed for an <em>msprime</em> tree sequence, which is fully coalesced (and recapitated) by definition. Still, if we were dealing with a SLiM tree sequence, which is the case for some of our other vignetted, we could do this in one go, by specifying <code>recapitate = TRUE</code> in the call to <code><a href="../reference/ts_load.html">ts_load()</a></code> after specifying a couple of additional arguments required for recapitation (see the pyslim documentation in the <a href="https://tskit.dev/pyslim/docs/latest/tutorial.html#recapitation" class="external-link">recapitation</a> section for more detail). If we do this on our current tree sequence object, we simply get a warning informing us that we’re attempting to do something that has no effect:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_load.html">ts_load</a></span><span class="op">(</span><span class="va">model</span>, recapitate <span class="op">=</span> <span class="cn">TRUE</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span>,
              recombination_rate <span class="op">=</span> <span class="fl">1e-8</span>, Ne <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></code></pre></div>
<p>We can make sure that our tree sequence is fully coalesced by calling another <em>slendr</em> function <code><a href="../reference/ts_coalesced.html">ts_coalesced()</a></code>. This is useful when dealing with <code><a href="../reference/slim.html">slim()</a></code>-produced tree sequences:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_coalesced.html">ts_coalesced</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; [1] TRUE</span></code></pre>
<p>You might have noticed that we did not simulate any mutations during the SLiM run. This is for computational efficiency. Luckily, the tree-sequence contains the complete history of a sample of individuals which makes it very easy to sprinkle mutations on the genealogies after this simulation is over. We can add mutations a given rate by running:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_mutate.html">ts_mutate</a></span><span class="op">(</span><span class="va">ts</span>, mutation_rate <span class="op">=</span> <span class="fl">1e-8</span>, random_seed <span class="op">=</span> <span class="fl">314159</span><span class="op">)</span>
<span class="va">ts</span></code></pre></div>
<pre><code><span class="co">#&gt; ╔═══════════════════════════╗</span>
<span class="co">#&gt; ║TreeSequence               ║</span>
<span class="co">#&gt; ╠═══════════════╤═══════════╣</span>
<span class="co">#&gt; ║Trees          │     237352║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sequence Length│  100000000║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Time Units     │generations║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Sample Nodes   │        116║</span>
<span class="co">#&gt; ╟───────────────┼───────────╢</span>
<span class="co">#&gt; ║Total Size     │   73.3 MiB║</span>
<span class="co">#&gt; ╚═══════════════╧═══════════╝</span>
<span class="co">#&gt; ╔═══════════╤══════╤═════════╤════════════╗</span>
<span class="co">#&gt; ║Table      │Rows  │Size     │Has Metadata║</span>
<span class="co">#&gt; ╠═══════════╪══════╪═════════╪════════════╣</span>
<span class="co">#&gt; ║Edges      │858165│ 26.2 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Individuals│    58│  1.6 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Migrations │     0│  8 Bytes│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Mutations  │623549│ 22.0 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Nodes      │138217│  3.7 MiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Populations│     4│338 Bytes│         Yes║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Provenances│     2│  7.7 KiB│          No║</span>
<span class="co">#&gt; ╟───────────┼──────┼─────────┼────────────╢</span>
<span class="co">#&gt; ║Sites      │621652│ 14.8 MiB│          No║</span>
<span class="co">#&gt; ╚═══════════╧══════╧═════════╧════════════╝</span></code></pre>
<p>Even this step can be performed in one go throught the <code>ts_load</code> function like this:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_load.html">ts_load</a></span><span class="op">(</span><span class="va">model</span>, recapitate <span class="op">=</span> <span class="cn">TRUE</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span>, mutate <span class="op">=</span> <span class="cn">TRUE</span>,
              recombination_rate <span class="op">=</span> <span class="fl">1e-8</span>, Ne <span class="op">=</span> <span class="fl">10000</span>, mutation_rate <span class="op">=</span> <span class="fl">1e-8</span>,
              random_seed <span class="op">=</span> <span class="fl">314159</span><span class="op">)</span></code></pre></div>
<p>Having done that, we can calculate some basic statistics on our simulated data.</p>
<p>However, before we do that, we would first like to note that everything that we do in the rest of this vignette (i.e. whenever we call a function with the prefix <code>ts_*()</code> in <em>slendr</em>), we are interfacing with the <em>tskit</em> Python module under the hood. Our goal is to capture most of the analyses one might want to perform on tree-sequences in R and wrap them in a neat interface indistinguishable from any other R function—this is, after all, the reason why <em>reticulate</em> has been created in the first place (making various Python data science modules appear as if they were regular R packages).</p>
</div>
<div class="section level2">
<h2 id="visualisation-of-trees-and-tree-sequences">Visualisation of trees and tree-sequences<a class="anchor" aria-label="anchor" href="#visualisation-of-trees-and-tree-sequences"></a>
</h2>
<p>Now we introduce a function <code><a href="../reference/ts_phylo.html">ts_phylo()</a></code> which can be used to extract one tree from the tree-sequence (either an <em>i</em>-th tree in the sequence, or a tree overlapping an <em>i</em>-th position of the simulated genome, depending on the value of its <code>mode</code> argument) and convert it to a <code>phylo</code> class, which is a standard format for phylogenetic trees in the R world. For more on the <code>phylo</code> format, see packages <a href="https://cran.r-project.org/package=ape" class="external-link">ape</a>, <a href="https://cran.r-project.org/package=phangorn" class="external-link">phangorn</a>, and <a href="https://cran.r-project.org/package=phytools" class="external-link">phytools</a>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract the 42nd tree in the tree sequence</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_phylo.html">ts_phylo</a></span><span class="op">(</span><span class="va">ts_small</span>, <span class="fl">42</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; Starting checking the validity of tree...</span>
<span class="co">#&gt; Found number of tips: n = 14 </span>
<span class="co">#&gt; Found number of nodes: m = 13 </span>
<span class="co">#&gt; Done.</span></code></pre>
<p>When we type the tree object to an R console, we can verify that we got an ordinary <code>phylo</code> object:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span></code></pre></div>
<pre><code><span class="co">#&gt; </span>
<span class="co">#&gt; Phylogenetic tree with 14 tips and 13 internal nodes.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Tip labels:</span>
<span class="co">#&gt;   13 (EUR_50), 12 (EUR_50), 11 (CH_1), 10 (CH_1), 9 (AFR_2), 8 (AFR_2), ...</span>
<span class="co">#&gt; Node labels:</span>
<span class="co">#&gt;   76943, 70, 1667, 3512, 7999, 11522, ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Rooted; includes branch lengths.</span></code></pre>
<p>This means that we have the whole R phylogenetic ecosystem at our disposal to analyze such trees. For instance we can use the powerful package <em>ggtree</em> to plot the tree we have just extracted:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/" class="external-link">ggtree</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; ggtree v3.2.1  For help: https://yulab-smu.top/treedata-book/</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; If you use ggtree in published research, please cite the most appropriate paper(s):</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1. Guangchuang Yu. Using ggtree to visualize data on tree-like structures. Current Protocols in Bioinformatics. 2020, 69:e96. doi:10.1002/cpbi.96</span>
<span class="co">#&gt; 2. Guangchuang Yu, Tommy Tsan-Yuk Lam, Huachen Zhu, Yi Guan. Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution. 2018, 35(12):3041-3043. doi:10.1093/molbev/msy194</span>
<span class="co">#&gt; 3. Guangchuang Yu, David Smith, Huachen Zhu, Yi Guan, Tommy Tsan-Yuk Lam. ggtree: an R package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution. 2017, 8(1):28-36. doi:10.1111/2041-210X.12628</span></code></pre>
<pre><code><span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ggtree'</span></code></pre>
<pre><code><span class="co">#&gt; The following object is masked from 'package:slendr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand</span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html" class="external-link">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html" class="external-link">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="op">!</span><span class="va">isTip</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># points for internal nodes</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html" class="external-link">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># sample labels for tips</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html" class="external-link">hexpand</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>    <span class="co"># make more space for the tip labels</span></code></pre></div>
<p><img src="vignette-05-tree-sequences_files/figure-html/plot_ggtree-1.png" width="480"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">nodelabels</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-tskit-functionality-directly">Accessing <em>tskit</em> functionality directly<a class="anchor" aria-label="anchor" href="#accessing-tskit-functionality-directly"></a>
</h2>
<p>As we mentioned in the previous section, the goal of this vignette is to show how to use <em>slendr</em> to perform the main tree-sequence operations using a convenient R interface to <em>tskit</em>. However, you should always keep in mind that you are not restricted to a subset of <em>tskit</em> functionality that <em>slendr</em> translated to R (i.e. <a href="../reference/index.html">all functions</a> with the prefix <code>ts_</code>). Thanks to the incredible R package <a href="https://rstudio.github.io/reticulate/index.html" class="external-link"><em>reticulate</em></a>, you can access Python methods and object variables directly, using the <code>$</code> operator.</p>
<p>As an example, instead of calling the function <code><a href="../reference/ts_coalesced.html">ts_coalesced()</a></code> on the tree-sequence as we did above, we could check that all trees are coalesced by running the following snippet instead (note that this is very inefficient and we’re only doing the operation for the first one hundred trees):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># iterate over all trees in the tree-sequence and check if each</span>
<span class="co"># has only one root (i.e. is fully coalesced) - note that Python</span>
<span class="co"># lists are 0-based, which is something we need to take care of</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">num_trees</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>,
           <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">ts</span><span class="op">$</span><span class="fu">at_index</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">num_roots</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We believe it makes sense to use the R interface whenever possible (even if only because it makes many operations a little bit more convenient). However, if there is some functionality in <em>slendr</em> missing, you can always resort to accessing the Python objects directly as we have just demonstrated. You can verify that all <a href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence" class="external-link">methods and attributes</a> of a Python tree-sequence object is still accessible in R:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt;   [1] "alignments"                      "allele_frequency_spectrum"      </span>
<span class="co">#&gt;   [3] "as_fasta"                        "as_nexus"                       </span>
<span class="co">#&gt;   [5] "aslist"                          "at"                             </span>
<span class="co">#&gt;   [7] "at_index"                        "breakpoints"                    </span>
<span class="co">#&gt;   [9] "coiterate"                       "count_topologies"               </span>
<span class="co">#&gt;  [11] "delete_intervals"                "delete_sites"                   </span>
<span class="co">#&gt;  [13] "diffs"                           "discrete_genome"                </span>
<span class="co">#&gt;  [15] "discrete_time"                   "divergence"                     </span>
<span class="co">#&gt;  [17] "diversity"                       "draw_svg"                       </span>
<span class="co">#&gt;  [19] "draw_text"                       "dump"                           </span>
<span class="co">#&gt;  [21] "dump_tables"                     "dump_text"                      </span>
<span class="co">#&gt;  [23] "edge"                            "edge_diffs"                     </span>
<span class="co">#&gt;  [25] "edges"                           "edgesets"                       </span>
<span class="co">#&gt;  [27] "equals"                          "f2"                             </span>
<span class="co">#&gt;  [29] "f3"                              "f4"                             </span>
<span class="co">#&gt;  [31] "file_uuid"                       "first"                          </span>
<span class="co">#&gt;  [33] "Fst"                             "genealogical_nearest_neighbours"</span>
<span class="co">#&gt;  [35] "general_stat"                    "genetic_relatedness"            </span>
<span class="co">#&gt;  [37] "genotype_matrix"                 "get_ll_tree_sequence"           </span>
<span class="co">#&gt;  [39] "get_num_mutations"               "get_num_nodes"                  </span>
<span class="co">#&gt;  [41] "get_num_records"                 "get_num_sites"                  </span>
<span class="co">#&gt;  [43] "get_num_trees"                   "get_pairwise_diversity"         </span>
<span class="co">#&gt;  [45] "get_population"                  "get_sample_size"                </span>
<span class="co">#&gt;  [47] "get_samples"                     "get_sequence_length"            </span>
<span class="co">#&gt;  [49] "get_time"                        "haplotypes"                     </span>
<span class="co">#&gt;  [51] "has_reference_sequence"          "ibd_segments"                   </span>
<span class="co">#&gt;  [53] "individual"                      "individuals"                    </span>
<span class="co">#&gt;  [55] "kc_distance"                     "keep_intervals"                 </span>
<span class="co">#&gt;  [57] "last"                            "ll_tree_sequence"               </span>
<span class="co">#&gt;  [59] "load"                            "load_tables"                    </span>
<span class="co">#&gt;  [61] "ltrim"                           "max_root_time"                  </span>
<span class="co">#&gt;  [63] "mean_descendants"                "metadata"                       </span>
<span class="co">#&gt;  [65] "metadata_schema"                 "migration"                      </span>
<span class="co">#&gt;  [67] "migrations"                      "mutation"                       </span>
<span class="co">#&gt;  [69] "mutations"                       "nbytes"                         </span>
<span class="co">#&gt;  [71] "newick_trees"                    "node"                           </span>
<span class="co">#&gt;  [73] "nodes"                           "num_edges"                      </span>
<span class="co">#&gt;  [75] "num_individuals"                 "num_migrations"                 </span>
<span class="co">#&gt;  [77] "num_mutations"                   "num_nodes"                      </span>
<span class="co">#&gt;  [79] "num_populations"                 "num_provenances"                </span>
<span class="co">#&gt;  [81] "num_samples"                     "num_sites"                      </span>
<span class="co">#&gt;  [83] "num_trees"                       "pairwise_diversity"             </span>
<span class="co">#&gt;  [85] "parse_windows"                   "population"                     </span>
<span class="co">#&gt;  [87] "populations"                     "provenance"                     </span>
<span class="co">#&gt;  [89] "provenances"                     "records"                        </span>
<span class="co">#&gt;  [91] "reference_sequence"              "rtrim"                          </span>
<span class="co">#&gt;  [93] "sample_count_stat"               "sample_size"                    </span>
<span class="co">#&gt;  [95] "samples"                         "segregating_sites"              </span>
<span class="co">#&gt;  [97] "sequence_length"                 "simplify"                       </span>
<span class="co">#&gt;  [99] "site"                            "sites"                          </span>
<span class="co">#&gt; [101] "subset"                          "table_metadata_schemas"         </span>
<span class="co">#&gt; [103] "tables"                          "tables_dict"                    </span>
<span class="co">#&gt; [105] "Tajimas_D"                       "time_units"                     </span>
<span class="co">#&gt; [107] "to_macs"                         "to_nexus"                       </span>
<span class="co">#&gt; [109] "trait_correlation"               "trait_covariance"               </span>
<span class="co">#&gt; [111] "trait_linear_model"              "trait_regression"               </span>
<span class="co">#&gt; [113] "trees"                           "trim"                           </span>
<span class="co">#&gt; [115] "union"                           "variants"                       </span>
<span class="co">#&gt; [117] "write_fasta"                     "write_nexus"                    </span>
<span class="co">#&gt; [119] "write_vcf"                       "Y1"                             </span>
<span class="co">#&gt; [121] "Y2"                              "Y3"</span></code></pre>
<p>In fact, you will recognize some of the elements in the output above from examples involving <code>ts_</code> functions in this vignette! In short, there is no blackbox—<em>slendr</em> only provides a slightly more convenient layer over <em>tskit</em> for R users.</p>
</div>
<div class="section level2">
<h2 id="calculating-f-statistics">Calculating <em>f</em>-statistics<a class="anchor" aria-label="anchor" href="#calculating-f-statistics"></a>
</h2>
<p>In addition to being a revolutionary breakthrough in terms of computation efficiency, many statistics that we are often interested in population genetics are a natural consequence of having a direct access to tree sequence genealogies, simply because those genealogies capture the true demographic history of a sample. Again, we can’t go into too much detail here but we encourage you to take a look at a paper by <a href="https://doi.org/10.1534/genetics.120.303253" class="external-link">Ralph <em>et al.</em></a> on the duality between statistics expressed in terms of branch lengths and the traditional summaries based on samples of genetic variation.</p>
<p>For instance, we have functions such as <code><a href="../reference/ts_f4ratio.html">ts_f2()</a></code>, <code><a href="../reference/ts_f4ratio.html">ts_f3()</a></code>, <code><a href="../reference/ts_f4ratio.html">ts_f4()</a></code> and <code><a href="../reference/ts_f4ratio.html">ts_f4ratio()</a></code> which calculate the well-known set of Patterson’s <span class="math inline">\(f\)</span>-statistics:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># f2 is a measure of the branch length connecting A and B</span>
<span class="fu"><a href="../reference/ts_f4ratio.html">ts_f2</a></span><span class="op">(</span><span class="va">ts</span>, A <span class="op">=</span> <span class="st">"EUR_1"</span>, B <span class="op">=</span> <span class="st">"AFR_1"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span>
<span class="co">#&gt;   A     B            f2</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> EUR_1 AFR_1 0.000<span style="text-decoration: underline;">057</span>2</span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># f4 is a measure of the drift shared between A and B after their split from C</span>
<span class="fu"><a href="../reference/ts_f4ratio.html">ts_f3</a></span><span class="op">(</span><span class="va">ts</span>, A <span class="op">=</span> <span class="st">"EUR_1"</span>, B <span class="op">=</span> <span class="st">"AFR_1"</span>, C <span class="op">=</span> <span class="st">"CH_1"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="co">#&gt;   A     B     C            f3</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> EUR_1 AFR_1 CH_1  0.000<span style="text-decoration: underline;">021</span>8</span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this value should be very close to zero (no introgression in Africans)</span>
<span class="fu"><a href="../reference/ts_f4ratio.html">ts_f4</a></span><span class="op">(</span><span class="va">ts</span>, <span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"NEA_1"</span>, <span class="st">"CH_1"</span>, mode <span class="op">=</span> <span class="st">"branch"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span>
<span class="co">#&gt;   W     X     Y     Z        f4</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFR_1 AFR_2 NEA_1 CH_1  -<span style="color: #BB0000;">120.</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this value should be significantly negative (many more ABBA sites</span>
<span class="co"># compared to BABA site due to the introgression into Europeans)</span>
<span class="fu"><a href="../reference/ts_f4ratio.html">ts_f4</a></span><span class="op">(</span><span class="va">ts</span>, <span class="st">"AFR_1"</span>, <span class="st">"EUR_1"</span>, <span class="st">"NEA_1"</span>, <span class="st">"CH_1"</span>, mode <span class="op">=</span> <span class="st">"branch"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span>
<span class="co">#&gt;   W     X     Y     Z        f4</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFR_1 EUR_1 NEA_1 CH_1  -<span style="color: #BB0000;">686.</span></span></code></pre>
<p>These functions accept a <code>mode =</code> argument, specifying whether the statistics should be calculated using mutation site patterns (<code>mode = "site"</code>, the default), branch lengths (<code>mode = "branch"</code>), or for each node (<code>mode = "node"</code>), as well as the <code>windows</code> argument, similarly to other “multiway” statistics implemented by tskit. See the <a href="https://tskit.dev/tskit/docs/stable/stats.html#sec-stats-mode" class="external-link">relevant</a> <a href="https://tskit.dev/tskit/docs/stable/stats.html#sec-stats-sample-sets-multi-way" class="external-link">sections</a> of the official <em>tskit</em> documentation for more on this topic.</p>
<p>Note that in the previous chunk we refered to individuals by their names (not numeric IDs of nodes as you would do it with <em>tskit</em> in Python). We allow this for readability and to make it easier to see which individuals are which based on the specified sampling schedule (the names are assigned to individuals based on the order of their sampling). We can get an overview of the individuals scheduled for sampling (i.e. permanently remembered) and their names with a helper function <code><a href="../reference/ts_samples.html">ts_samples()</a></code>:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_samples.html">ts_samples</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 58 × 3</span></span>
<span class="co">#&gt;    name   time pop  </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> NEA_1 <span style="text-decoration: underline;">70</span>000 NEA  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> NEA_2 <span style="text-decoration: underline;">40</span>000 NEA  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> EUR_1 <span style="text-decoration: underline;">39</span>170 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> EUR_2 <span style="text-decoration: underline;">39</span>134 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> EUR_3 <span style="text-decoration: underline;">37</span>738 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> EUR_4 <span style="text-decoration: underline;">36</span>530 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> EUR_5 <span style="text-decoration: underline;">36</span>362 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> EUR_6 <span style="text-decoration: underline;">35</span>944 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> EUR_7 <span style="text-decoration: underline;">33</span>900 EUR  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> EUR_8 <span style="text-decoration: underline;">33</span>853 EUR  </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 48 more rows</span></span></code></pre>
<p>That said, if you would like to run some statistics on nodes rather than on individuals, you can do it simply by using integer IDs instead of character names in each function’s interface.</p>
</div>
<div class="section level2">
<h2 id="estimating-neanderthal-ancestry-proportions">Estimating Neanderthal ancestry proportions<a class="anchor" aria-label="anchor" href="#estimating-neanderthal-ancestry-proportions"></a>
</h2>
<p>Let’s try to put these new tools to practice and estimate the proportion of Neanderthal ancestry in Africans and Europeans in our simulated data. We can do this using the Patterson’s <span class="math inline">\(f_4\)</span>-ratio statistic implemented in the <code><a href="../reference/ts_f4ratio.html">ts_f4ratio()</a></code> function in <em>slendr</em> (you can find more information about this particular version of the statistic <a href="https://www.pnas.org/content/116/5/1639" class="external-link">in this paper</a>):</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first get a table of simulated African and European individuals in the tree-sequence</span>
<span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_samples.html">ts_samples</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pop</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR"</span>, <span class="st">"EUR"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># estimate the amounts of Neanderthal ancestry in these individuals and add</span>
<span class="co"># these values to the table</span>
<span class="va">inds</span><span class="op">$</span><span class="va">ancestry</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_f4ratio.html">ts_f4ratio</a></span><span class="op">(</span><span class="va">ts</span>, X <span class="op">=</span> <span class="va">inds</span><span class="op">$</span><span class="va">name</span>, <span class="st">"NEA_1"</span>, <span class="st">"NEA_2"</span>, <span class="st">"AFR_1"</span>, <span class="st">"CH_1"</span><span class="op">)</span><span class="op">$</span><span class="va">alpha</span></code></pre></div>
<p>If we now summarise the inferred Neanderthal distribution in both populations, we see that there is no Neanderthal ancestry in Africans (as expected by our model–Africans did not receive a Neanderthal introgression pulse) but there is a small proportion of Neanderthal ancestry in Europeans (consistent with the 3% introgression pulse we simulated between):</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">inds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">ancestry</span>, fill <span class="op">=</span> <span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Neanderthal ancestry proportion"</span>, x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-05-tree-sequences_files/figure-html/ts_nea_distributions-1.png" width="480"></p>
<p>This is exactly as we specified in the model configuration above, suggesting that our simulations work as they should. You can see that there is quite a bit of noise but that’s because we simulated only a small amount of sequence.</p>
<p>We can also plot the trajectory of Neanderthal ancestry in Europe during the time-window for which we have simulated ancient and present-day DNA samples:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">inds</span>, <span class="va">pop</span> <span class="op">==</span> <span class="st">"EUR"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">ancestry</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time [years ago]"</span>, y <span class="op">=</span> <span class="st">"Neanderthal ancestry proportion"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre>
<p><img src="vignette-05-tree-sequences_files/figure-html/ts_nea_trajectory-1.png" width="480"></p>
<p>Again, this is a result consistent with empirical estimates of Neanderthal ancestry using <a href="https://www.pnas.org/content/116/5/1639" class="external-link">ancient DNA data</a>.</p>
</div>
<div class="section level2">
<h2 id="admixtools-analyses">ADMIXTOOLS analyses<a class="anchor" aria-label="anchor" href="#admixtools-analyses"></a>
</h2>
<p>In case you would like to verify some <em>f</em>-statistics results using the venerable <a href="https://doi.org/10.1534/genetics.112.145037" class="external-link">ADMIXTOOLS</a> software (see the linked paper which formally introduced these statistics in the first place), you can convert the tree-sequence data to a file format called EIGENSTRAT using the <code><a href="../reference/ts_eigenstrat.html">ts_eigenstrat()</a></code> function. The file conversion is internally handled by the R package <a href="https://bodkan.net/admixr/" class="external-link"><em>admixr</em></a> and returns an <code>EIGENSTRAT</code> object which ties all individual <code>EIGENSTRAT</code> file components together (see the <a href="https://bodkan.net/admixr/articles/tutorial.html" class="external-link">tutorial</a> to <em>admixr</em> for an extensive overview). <em>admixr</em> is an R package for running automated ADMIXTOOLS analyses entirely from R and makes these types of analyses very convenient.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_eigenstrat.html">ts_eigenstrat</a></span><span class="op">(</span><span class="va">ts</span>, prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"eigenstrat"</span>, <span class="st">"data"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; 1295 multiallelic sites (0.208% out of 621652 total) detected and removed</span></code></pre>
<p>Running an <em>admixr</em> analysis is then as easy as plugging the object into an <em>admixr</em> function. For instance, we can estimate the proportion of Neanderthal ancestry in a couple of individuals <span class="math inline">\(X\)</span> like this (<em>admixr</em> calls this proportion <code>alpha</code>):</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bodkan/admixr" class="external-link">admixr</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/admixr/man/f4ratio.html" class="external-link">f4ratio</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">snps</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span>, <span class="st">"AFR_2"</span><span class="op">)</span>,
        A <span class="op">=</span> <span class="st">"NEA_1"</span>, B <span class="op">=</span> <span class="st">"NEA_2"</span>, C <span class="op">=</span> <span class="st">"AFR_1"</span>, O <span class="op">=</span> <span class="st">"CH_1"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 8</span></span>
<span class="co">#&gt;   A     B     X     C     O       alpha  stderr Zscore</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> NEA_1 NEA_2 EUR_1 AFR_1 CH_1  0.020<span style="text-decoration: underline;">2</span>  0.006<span style="text-decoration: underline;">64</span>   3.05</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> NEA_1 NEA_2 EUR_2 AFR_1 CH_1  0.018<span style="text-decoration: underline;">0</span>  0.006<span style="text-decoration: underline;">17</span>   2.92</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> NEA_1 NEA_2 AFR_2 AFR_1 CH_1  0.006<span style="text-decoration: underline;">18</span> 0.002<span style="text-decoration: underline;">62</span>   2.36</span></code></pre>
<p>In fact, lets compare the values obtained by both <em>tskit</em> and <em>admixr</em>/ADMIXTOOLS for all individuals:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">europeans</span> <span class="op">&lt;-</span> <span class="va">inds</span><span class="op">[</span><span class="va">inds</span><span class="op">$</span><span class="va">pop</span> <span class="op">==</span> <span class="st">"EUR"</span>, <span class="op">]</span><span class="op">$</span><span class="va">name</span>

<span class="co"># tskit result</span>
<span class="va">result_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_f4ratio.html">ts_f4ratio</a></span><span class="op">(</span><span class="va">ts</span>, X <span class="op">=</span> <span class="va">europeans</span>, A <span class="op">=</span> <span class="st">"NEA_1"</span>, B <span class="op">=</span> <span class="st">"NEA_2"</span>, C <span class="op">=</span> <span class="st">"AFR_1"</span>, O <span class="op">=</span> <span class="st">"CH_1"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>alpha_ts <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>

<span class="co"># result obtained by admixr/ADMIXTOOLS</span>
<span class="va">result_admixr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/admixr/man/f4ratio.html" class="external-link">f4ratio</a></span><span class="op">(</span><span class="va">snps</span>, X <span class="op">=</span> <span class="va">europeans</span>, A <span class="op">=</span> <span class="st">"NEA_1"</span>, B <span class="op">=</span> <span class="st">"NEA_2"</span>, C <span class="op">=</span> <span class="st">"AFR_1"</span>, O <span class="op">=</span> <span class="st">"CH_1"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>alpha_admixr <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">result_admixr</span>, <span class="va">result_ts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">alpha_ts</span>, <span class="va">alpha_admixr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"f4-ratio statistic calculated with admixr/ADMIXTOOLS"</span>,
       y <span class="op">=</span> <span class="st">"f4-ratio statistic calculated with tskit"</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-05-tree-sequences_files/figure-html/ts_vs_admixr-1.png" width="480"></p>
<p>The correspondence between the two looks good! 🎉 Again, note that the large amount of variance around the expected value of 3% ancestry is due to an extremely small amount of sequence data simulated here.</p>
</div>
<div class="section level2">
<h2 id="vcf-output">VCF output<a class="anchor" aria-label="anchor" href="#vcf-output"></a>
</h2>
<p>In case you need to process simulated data in some other software, you can use the function <code><a href="../reference/ts_vcf.html">ts_vcf()</a></code> to save the simulated genotypes in a VCF format:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_vcf.html">ts_vcf</a></span><span class="op">(</span><span class="va">ts</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"output.vcf.gz"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can also specify only a subset of individuals to be saved in the VCF:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_vcf.html">ts_vcf</a></span><span class="op">(</span><span class="va">ts</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"output_subset.vcf.gz"</span><span class="op">)</span>,
       individuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CH_1"</span>, <span class="st">"NEA_1"</span>, <span class="st">"EUR_1"</span>, <span class="st">"AFR_1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-statistics">Other statistics<a class="anchor" aria-label="anchor" href="#other-statistics"></a>
</h2>
<p>What follows is a very brief overview of other statistics which are implemented in <em>tskit</em> and for which <em>slendr</em> provides an easy-to-use R interface. As you will see, the goal of these functions is to get you to a result using a single function call, making them very convenient for quick interactive exploratory analyses on the simulated data right in the R console.</p>
<p>We will continue to use our simulated Neanderthal introgression tree-sequence data for these examples.</p>
<div class="section level3">
<h3 id="f_st">
<span class="math inline">\(F_{st}\)</span><a class="anchor" aria-label="anchor" href="#f_st"></a>
</h3>
<p>The <span class="math inline">\(F_{st}\)</span> statistic is implemented by the function <code><a href="../reference/ts_fst.html">ts_fst()</a></code>.</p>
<p>If a single genome-wide <span class="math inline">\(F_{st}\)</span> is to be calculated (i.e. not a window-based calculation), the <code><a href="../reference/ts_fst.html">ts_fst()</a></code> returns a simple three-column data frame</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_fst.html">ts_fst</a></span><span class="op">(</span><span class="va">ts</span>, sample_sets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>afr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"AFR_3"</span><span class="op">)</span>, eur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span>
<span class="co">#&gt;   x     y        Fst</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> afr   eur   0.054<span style="text-decoration: underline;">8</span></span></code></pre>
<p>In case a non-named list of sample sets was provided, set names are generated automatically:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_fst.html">ts_fst</a></span><span class="op">(</span><span class="va">ts</span>, sample_sets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"AFR_3"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span>
<span class="co">#&gt;   x     y        Fst</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> set_1 set_2 0.054<span style="text-decoration: underline;">8</span></span></code></pre>
<p>Of course, this is much less readable and we encourage you to name the sample sets appropriately.</p>
<p>In case more than two sample sets are specified, all pairwise statistics are computed:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_fst.html">ts_fst</a></span><span class="op">(</span><span class="va">ts</span>, sample_sets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>afr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"AFR_3"</span><span class="op">)</span>,
                              eur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span><span class="op">)</span>,
                              nea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NEA_1"</span>, <span class="st">"NEA_2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span>
<span class="co">#&gt;   x     y        Fst</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> afr   eur   0.054<span style="text-decoration: underline;">8</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> afr   nea   0.554 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> eur   nea   0.547</span></code></pre>
<p>As with many other statistics implemented by <a href="https://tskit.dev/tskit/docs/stable/python-api.html" class="external-link"><em>tskit</em></a><em>,</em> <code><a href="../reference/ts_fst.html">ts_fst()</a></code> accepts a <code>windows</code> argument, specifying the breakpoints between windows. In this case, the <code>Fst</code> column in the resulting data frame is a so called “list-column”, with each item in the column being a vector of <span class="math inline">\(F_{st}\)</span> values, one per each window. List-columns can be a little confusing for new R users, but we highly encourage you to get used to them as they allow extremely consise and elegant handling of structured data within normal data frames (you can start with <a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html" class="external-link">this</a> introduction).</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define breakpoints between 20 windows</span>
<span class="va">breakpoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ts</span><span class="op">$</span><span class="va">sequence_length</span>, length.out <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>

<span class="co"># calculate window-based Fst statistic</span>
<span class="va">win_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_fst.html">ts_fst</a></span><span class="op">(</span>
  <span class="va">ts</span>, windows <span class="op">=</span> <span class="va">breakpoints</span>,
  sample_sets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>afr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"AFR_3"</span><span class="op">)</span>,
                     eur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span><span class="op">)</span>,
                     nea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NEA_1"</span>, <span class="st">"NEA_2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># we get 20 values for each parwise calculation</span>
<span class="va">win_fst</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span>
<span class="co">#&gt;   x     y     Fst         </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> afr   eur   <span style="color: #949494;">&lt;dbl [20]&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> afr   nea   <span style="color: #949494;">&lt;dbl [20]&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> eur   nea   <span style="color: #949494;">&lt;dbl [20]&gt;</span></span></code></pre>
<p>For instance, here are window-based <span class="math inline">\(F_st\)</span> values for the <code>afr-vs-eur</code> calculation (first row of the table above):</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">win_fst</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">Fst</span></code></pre></div>
<pre><code><span class="co">#&gt; $`1`</span>
<span class="co">#&gt;  [1] 0.07196316 0.03738926 0.05256038 0.03671481 0.06204939 0.03626783</span>
<span class="co">#&gt;  [7] 0.07445082 0.07191628 0.04078492 0.02880674 0.08310961 0.06680257</span>
<span class="co">#&gt; [13] 0.05513232 0.05122444 0.05378418 0.04748802 0.07068459 0.05085781</span>
<span class="co">#&gt; [19] 0.05397786 0.05445323</span></code></pre>
</div>
<div class="section level3">
<h3 id="tajimas-d">Tajima’s <span class="math inline">\(D\)</span><a class="anchor" aria-label="anchor" href="#tajimas-d"></a>
</h3>
<p>The function <code><a href="../reference/ts_tajima.html">ts_tajima()</a></code> has nearly the same interface as <code><a href="../reference/ts_fst.html">ts_fst()</a></code> shown above.</p>
<p>If a non-window version is to be calculated, we get a single genome-wide values for each sample set (named or non-named list of character vectors with individual names):</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_tajima.html">ts_tajima</a></span><span class="op">(</span><span class="va">ts</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>afr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span>, <span class="st">"AFR_3"</span><span class="op">)</span>, eur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span>
<span class="co">#&gt;   set            D</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> afr   -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">0</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> eur   -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">069</span><span style="color: #BB0000;">3</span></span></code></pre>
<p>For window-based version, the function returns the <code>D</code> column as a list column of vectors with <span class="math inline">\(i\)</span>-th element being the Tajima’s D value for the <span class="math inline">\(i\)</span>-th window:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_tajima.html">ts_tajima</a></span><span class="op">(</span><span class="va">ts</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>afr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFR_1"</span>, <span class="st">"AFR_2"</span><span class="op">)</span>, eur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EUR_1"</span>, <span class="st">"EUR_2"</span><span class="op">)</span><span class="op">)</span>, windows <span class="op">=</span> <span class="va">breakpoints</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span>
<span class="co">#&gt;   set   D           </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> afr   <span style="color: #949494;">&lt;dbl [20]&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> eur   <span style="color: #949494;">&lt;dbl [20]&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="diversity">Diversity<a class="anchor" aria-label="anchor" href="#diversity"></a>
</h3>
<p>We can calculate diversity within given groups of individuals with the function <code><a href="../reference/ts_diversity.html">ts_diversity()</a></code>. For instance, even in our extremely simplified example, we would expect the highest levels of diversity in Africans, followed by Europeans, Neanderthals and the “degenerate” single individual outgroup “chimpanzee”. Is this true? Let’s find out.</p>
<p>First we extract individuals from all populations, creating a list of character vectors for each group (which is what functions such as <code><a href="../reference/ts_diversity.html">ts_diversity()</a></code> expects as an input):</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get sampled individuals from all populations</span>
<span class="va">sample_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts_samples.html">ts_samples</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">.</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span> <span class="va">pop</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>

<span class="va">sample_sets</span></code></pre></div>
<pre><code><span class="co">#&gt; $AFR</span>
<span class="co">#&gt; [1] "AFR_1" "AFR_2" "AFR_3" "AFR_4" "AFR_5"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CH</span>
<span class="co">#&gt; [1] "CH_1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $EUR</span>
<span class="co">#&gt;  [1] "EUR_1"  "EUR_2"  "EUR_3"  "EUR_4"  "EUR_5"  "EUR_6"  "EUR_7"  "EUR_8" </span>
<span class="co">#&gt;  [9] "EUR_9"  "EUR_10" "EUR_11" "EUR_12" "EUR_13" "EUR_14" "EUR_15" "EUR_16"</span>
<span class="co">#&gt; [17] "EUR_17" "EUR_18" "EUR_19" "EUR_20" "EUR_21" "EUR_22" "EUR_23" "EUR_24"</span>
<span class="co">#&gt; [25] "EUR_25" "EUR_27" "EUR_26" "EUR_28" "EUR_29" "EUR_30" "EUR_31" "EUR_32"</span>
<span class="co">#&gt; [33] "EUR_33" "EUR_34" "EUR_35" "EUR_36" "EUR_37" "EUR_38" "EUR_39" "EUR_40"</span>
<span class="co">#&gt; [41] "EUR_41" "EUR_42" "EUR_43" "EUR_44" "EUR_45" "EUR_46" "EUR_47" "EUR_48"</span>
<span class="co">#&gt; [49] "EUR_49" "EUR_50"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NEA</span>
<span class="co">#&gt; [1] "NEA_1" "NEA_2"</span></code></pre>
<p>Now we can calculate diversity in each population and sort the results in an increasing order of diversity:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_diversity.html">ts_diversity</a></span><span class="op">(</span><span class="va">ts</span>, <span class="va">sample_sets</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">diversity</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span>
<span class="co">#&gt;   set   diversity</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CH    0.000<span style="text-decoration: underline;">043</span>9</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> NEA   0.000<span style="text-decoration: underline;">048</span>2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> EUR   0.000<span style="text-decoration: underline;">394</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> AFR   0.000<span style="text-decoration: underline;">396</span></span></code></pre>
<p>Great! This matches our expectations. We simulated chimp “population” as only one individual, so we expect essentially no diversity after millions of years of evolution.</p>
</div>
<div class="section level3">
<h3 id="divergence">Divergence<a class="anchor" aria-label="anchor" href="#divergence"></a>
</h3>
<p>We can calculate pairwise divergence between groups of individuals using the function <code><a href="../reference/ts_fst.html">ts_divergence()</a></code>. Given our model, we would expect the lowest divergence between the two modern human groups <code>AFR</code> and <code>EUR</code>, then between Neanderthals and the two modern humans, and all three groups (<code>AFR</code>, <code>EUR</code> and <code>NEA</code>) should have equal, much deeper divergence from the outgroup chimpanzee <code>CH</code>.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ts_fst.html">ts_divergence</a></span><span class="op">(</span><span class="va">ts</span>, <span class="va">sample_sets</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">divergence</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   x     y     divergence</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFR   EUR     0.000<span style="text-decoration: underline;">448</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> EUR   NEA     0.000<span style="text-decoration: underline;">752</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AFR   NEA     0.000<span style="text-decoration: underline;">774</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> CH    NEA     0.004<span style="text-decoration: underline;">02</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> CH    EUR     0.004<span style="text-decoration: underline;">03</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> AFR   CH      0.004<span style="text-decoration: underline;">04</span></span></code></pre>
<p>After sorting the table based on the value in the divergence column, we can see the results fit our expectations.</p>
</div>
</div>
<div class="section level2">
<h2 id="more-information">More information<a class="anchor" aria-label="anchor" href="#more-information"></a>
</h2>
<p>These were only a couple of examples of statistical functions implemented in <em>tskit</em> for which we provide a native R interface in <em>slendr</em>. You can find more tree-sequence statistics in the <a href="../reference/index.html#section-tree-sequence-statistics">reference manual</a> on the project website. Not <a href="https://tskit.dev/tskit/docs/stable/stats.html#available-statistics" class="external-link">all statistics</a> from the <em>tskit</em> library are implemented, but we intend to expand the selection provided by <em>slendr</em> in the near future. If there is some functionality that you would like to use in your project missing in <em>slendr</em>, please don’t hesitate to let us now by creating an issue on our <a href="https://github.com/bodkan/slendr/issues" class="external-link">GitHub page</a>.</p>
<p>Finally, if you would like to see more examples of <em>tskit</em> interface in action, take a look at the vignette which describes <a href="vignette-07-backends.html">switching between the SLiM and <em>msprime</em> back ends</a> of the <em>slendr</em> package.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Petr.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'a895c93f0e9eda05eb10b29a9921d586',
    indexName: 'slendr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
