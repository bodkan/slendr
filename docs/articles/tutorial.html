<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>spammr: Introduction and tutorial • spammr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="spammr: Introduction and tutorial">
<meta property="og:description" content="spammr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spammr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">spammr: Introduction and tutorial</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tutorial_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>spammr: Introduction and tutorial</h1>
            
      
      
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
</div>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p><strong>What we want to do is simulate this kind of population history (splits and admixture events):</strong></p>
<p><img src="figures/admixture_graph.png" style="width:80.0%"></p>
<p><strong>in the context of this:</strong></p>
<p><img src="figures/haak_map.png" style="width:80.0%"></p>
<p><strong>to produce this kind of data:</strong></p>
<p><img src="figures/sim_data.png" style="width:80.0%"></p>
<p>This is possible to do in <a href="https://messerlab.org/slim/">SLiM</a> using its <code>defineSpatialMap()</code> functionality. However, there is currently no way to define spatial maps programmatically, let alone build spatio-temporal models which include population splits, admixture, migration, and expansion. The package <code>spammr</code> is designed to do exactly this, and feed the generated spatial maps into a dedicated back-end SLiM script.</p>
</div>
<div id="philosophy" class="section level2">
<h2 class="hasAnchor">
<a href="#philosophy" class="anchor"></a>Philosophy</h2>
<p>Geospatial analysis is a deep and complex topic, with many dozen libraries and programs designed to deal with the annoying fact that the Earth is a sphere but we often have no other choice but to plot things (and simulate things in our case!) on a two-dimensional plane.</p>
<p>Luckily, most of the technical issues with <a href="https://en.wikipedia.org/wiki/Spatial_reference_system">Coordinate Reference Systems</a>, transformations between them and manipulation of geometric objects are pretty much solved now. Unfortunately, dealing with these issues in practice is quite challenging and requires non-trivial amount of domain expertise. Programming even a simple task in this context also requires a lot of code and there are no tools available for programming population genetic simulations which are explicitly spatial in nature.</p>
<p>This R package is designed to provide a collection of primitives (a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">Domain Specific Language</a> of sorts) for encoding migration and spatial boundaries of populations across space and time <em>without having to explicitly deal with many of the challenges inherent to geospatial analyses</em>.</p>
<p>Another goal is to make these spatio-temporal models fully reproducible, easy to write and debug by inspecting each step of the configuration visually, and finally to allow automated feeding of defined spatial maps into the <a href="https://messerlab.org/slim/">SLiM</a> population genetics simulation framework.</p>
<p><img src="tutorial_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="installation-and-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-and-setup" class="anchor"></a>Installation and setup</h2>
<p>First, let’s install the latest version of the package and load it:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"bodkan/spammr"</span><span class="op">)</span></code></pre></div>
<p>Now we can load it with other R package dependencies:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#library(spammr)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="st">"~/projects/spammr"</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading spammr</span></code></pre></div>
</div>
<div id="defining-the-overall-world-map" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-the-overall-world-map" class="anchor"></a>Defining the overall world map</h2>
<p>Before we do anything else, we need to define a section of the map of the world which will provide context for all downstream spatio-temporal manipulation of population ranges.</p>
<p>In principle, any source of geospatial data which can be manipulated using the <a href="https://r-spatial.github.io/sf/">simple features (sf)</a> infrastructure could be used. For now the <code>spammr</code> package implicitly uses the <a href="https://www.naturalearthdata.com/">Natural Earth</a> project data (in it’s vectorizes form!), which it internally loads using the <a href="https://cran.r-project.org/web/packages/rnaturalearth/README.html">rnaturalearth</a> interface.</p>
<p>The first function we will look at is <code><a href="../reference/world_map.html">world_map()</a></code>, which will load the map of the entire world in a vectorized format and zoom in (in fact, crop) to a specified section of the world.</p>
<p>Note that in the call below, we specify the coordinates of the zoom in a geographical Coordinate Reference System (CRS), i.e. longitude/latitude), but we also specified that we want to perform all the downstream manipulation of the spatial population maps in a projected CRS (<a href="https://epsg.io/3035">Lambert Azimuthal Equal-Area projection</a>). This is more appropriate for representing a wider European continent used in this tutorial. Of course, different CRS projection could be used based on which part of the world we want to simulate.</p>
<p>This is the current approach of <code>spammr</code>: let the user specify everything in an easy to understand longitude/latitude geographical CRS. However, in case it is necessary, the internal data structures and the final exported spatial maps can be internally handled in a realistic projected CRS which is better for ensuring undistorted distances and proportions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/world_map.html">world_map</a></span><span class="op">(</span>
  lon_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">60</span><span class="op">)</span>,  <span class="co"># min-max longitude</span>
  lat_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">65</span><span class="op">)</span>,   <span class="co"># min-max latitude</span>
  crs <span class="op">=</span> <span class="st">"EPSG:3035"</span>  <span class="co"># real projected CRS used internally</span>
<span class="op">)</span>
<span class="co">#&gt; OGR data source with driver: ESRI Shapefile </span>
<span class="co">#&gt; Source: "/private/var/folders/hr/_t1b0f5n7c76yrfsg8yk9l100000gn/T/RtmpM0zqDj", layer: "ne_110m_land"</span>
<span class="co">#&gt; with 127 features</span>
<span class="co">#&gt; It has 3 fields</span></code></pre></div>
<p>Internally, the <code>world</code> object is a normal <code>sf</code> class object without additional components. This is unlike other <code>spammr</code> object described below, which are also <code>sf</code> objects but which carry additional internal components.</p>
<p>Note that the summary of the object says “projected CRS: ETRS89-extended / LAEA Europe”. This means that the world map has indeed been transformed in the projected CRS we specified above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world</span>
<span class="co">#&gt; spammr 'world' object </span>
<span class="co">#&gt; --------------------- </span>
<span class="co">#&gt; projected CRS: ETRS89-extended / LAEA Europe</span></code></pre></div>
</div>
<div id="plotting-geographical-features-and-population-ranges" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-geographical-features-and-population-ranges" class="anchor"></a>Plotting geographical features and population ranges</h2>
<p>The <code>spammr</code> package implements its own <a href="https://adv-r.hadley.nz/s3.html#s3-methods">generic method</a> called <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, which overrides the default <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function used for <a href="https://r-spatial.github.io/sf/index.html">simple features</a> <code>sf</code> objects.</p>
<p>We do this in order to make it easier and more convenient to iteratively build more complex models. The function can smartly decide based given input arguments, what is the right way to present the data for the user which helps to define models more quickly without relying on the lower-level mechanisms of the <code>sf</code> package.</p>
<p>More on that below, but here we will just plot the world context we just created:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">world</span>, title <span class="op">=</span> <span class="st">"Zoomed-in world map context"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="defining-smaller-geographic-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-smaller-geographic-regions" class="anchor"></a>Defining smaller geographic regions</h2>
<p>In addition to the overall spatial map context, we can also define smaller geographic boundaries. This is mostly useful whenever we want to restrict a population movement (such as spatial population expansion) to a smaller region of the map that has some intuitive geographic meaning (i.e. Anatolia, West Eurasia, etc.).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">europe_anatolia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region.html">region</a></span><span class="op">(</span>
  <span class="st">"Western Europe &amp; Anatolia"</span>,
  <span class="va">world</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">38</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">35</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">45</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">58</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region.html">region</a></span><span class="op">(</span>
  <span class="st">"Western Europe"</span>,
  <span class="va">world</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">36</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">38</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">45</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">58</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">50</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">anatolia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region.html">region</a></span><span class="op">(</span>
  <span class="st">"Anatolia"</span>,
  <span class="va">world</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">35</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">35</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">43</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">27</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">38</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Again, the object returned by the <code><a href="../reference/region.html">region()</a></code> function is actually a normal <code>sf</code> object, but carrying some additional annotation such as the name of the region (here “Anatolia”):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anatolia</span>
<span class="co">#&gt; spammr 'region' object </span>
<span class="co">#&gt; ---------------------- </span>
<span class="co">#&gt; projected CRS: ETRS89-extended / LAEA Europe</span></code></pre></div>
<p>However, the object also carries additional class annotations for the purpose of internal <code>spammr</code> machinery:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">anatolia</span><span class="op">)</span>
<span class="co">#&gt; [1] "spammr"        "spammr_region" "sf"            "data.frame"</span></code></pre></div>
<p>Furthermore, note that in all <code><a href="../reference/region.html">region()</a></code> calls we specified the <code>world</code> object defined at the very beginning. This object is added as a hidden attribute to each <code>spammr</code> object and represents the context for all geospatial transformations, expansions, and plotting.</p>
<p>Again, we can use the generic <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function to plot both geographic regions in the context of the defined section of the world map:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">europe</span>, <span class="va">anatolia</span>, title <span class="op">=</span> <span class="st">"Geographic regions"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Note that the <code>world</code> object is no longer explicitly specified. It is not needed, because each other class of objects provided to the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function must carry it as a “world” attribute. In fact, each such object must carry the same world context - <code>spammr</code> complains whenever this is not the case.</p>
<p>We can check that the component is really there, although hidden, and indeed is the same as the world object we created at the beginning:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">europe</span>, <span class="st">"world"</span><span class="op">)</span> <span class="op">==</span> <span class="va">world</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">anatolia</span>, <span class="st">"world"</span><span class="op">)</span> <span class="op">==</span> <span class="va">world</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="defining-spatial-population-boundaries" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-spatial-population-boundaries" class="anchor"></a>Defining spatial population boundaries</h2>
<div id="circular-population-ranges" class="section level3">
<h3 class="hasAnchor">
<a href="#circular-population-ranges" class="anchor"></a>Circular population ranges</h3>
<p>The whole point of <code>spammr</code> is formalizing the specification of spatial population boundaries and their changes over time. The core function for this is <code><a href="../reference/population.html">population()</a></code>, which accepts the population <code>name</code> and the <code>time</code> in which we want to enforce that population’s boundary, as well as the <code>world</code> object described above. Finally, this function accepts a <code>center</code> and <code>radius</code> arguments (in case of circular population boundaries):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ooa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  <span class="st">"OOA"</span>,
  time <span class="op">=</span> <span class="fl">55000</span>,
  parent <span class="op">=</span> <span class="st">"ancestor"</span>,
  Ne <span class="op">=</span> <span class="fl">2000</span>,
  <span class="va">world</span>,
  center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">45</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">500</span>
<span class="op">)</span>

<span class="va">whg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"WHG"</span>,       <span class="co"># population identifier</span>
  time <span class="op">=</span> <span class="fl">25000</span>,       <span class="co"># time in years ago</span>
  Ne <span class="op">=</span> <span class="fl">4000</span>,
  parent <span class="op">=</span> <span class="va">ooa</span>,
  <span class="va">world</span>,              <span class="co"># world map 'context' for the population</span>
  center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">47</span><span class="op">)</span>, <span class="co"># (longitude, latitude)</span>
  radius <span class="op">=</span> <span class="fl">1300</span>       <span class="co"># radius of a circle in km</span>
<span class="op">)</span></code></pre></div>
<p>If we call the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function on the returned object, we have the option to either plot the population range in its “raw” form or in its interected form, in which case the raw boundary is intersected with spatial landscape (removing large bodies of water, etc.).</p>
<p>The intersected form is what is ultimately exported in a serialized form (see below) to be loaded as a spatial map into SLiM. This is why the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function renders population ranges by default.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">whg</span>, intersect <span class="op">=</span> <span class="cn">F</span>, title <span class="op">=</span> <span class="st">"'Raw' population range"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">whg</span>, title <span class="op">=</span> <span class="st">"'Intersected' population range"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
</div>
<div id="polygon-population-ranges" class="section level3">
<h3 class="hasAnchor">
<a href="#polygon-population-ranges" class="anchor"></a>Polygon population ranges</h3>
<p>Alternatively, it is also possible to define finer population boundaries using a polygon geometry object (<code>coords=</code> argument) or a region object created by the <code><a href="../reference/region.html">region()</a></code> function above. Again, as a reminder, note that all coordinates are described in the context of the geographic CRS.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">whg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"WHG"</span>,   <span class="co"># population identifier</span>
  time <span class="op">=</span> <span class="fl">25000</span>,   <span class="co"># time in years ago</span>
  Ne <span class="op">=</span> <span class="fl">4000</span>,
  parent <span class="op">=</span> <span class="va">ooa</span>,
  <span class="va">world</span>,          <span class="co"># world map 'context' for the population</span>
  region <span class="op">=</span> <span class="va">europe</span> <span class="co"># geographic region object</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">whg</span>, intersect <span class="op">=</span> <span class="cn">F</span>, title <span class="op">=</span> <span class="st">"'Raw' population range"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">whg</span>, title <span class="op">=</span> <span class="st">"'Intersected' population range"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
<p>Let’s create more populations and their boundaries:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ana</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"ANA"</span>, time <span class="op">=</span> <span class="fl">9000</span>, Ne <span class="op">=</span> <span class="fl">8000</span>, parent <span class="op">=</span> <span class="va">ooa</span>,
  <span class="va">world</span>,center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">38</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">700</span>,
  region <span class="op">=</span> <span class="va">anatolia</span>
<span class="op">)</span>

<span class="va">yam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"YAM"</span>, time <span class="op">=</span> <span class="fl">7000</span>, Ne <span class="op">=</span> <span class="fl">6000</span>, parent <span class="op">=</span> <span class="va">ooa</span>,
  <span class="va">world</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>   <span class="co"># polygon specified using coordinates of vertices</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">49</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">50</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">56</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">59</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">56</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">neol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  name<span class="op">=</span> <span class="st">"NEOL"</span>, time <span class="op">=</span> <span class="fl">7000</span>, Ne <span class="op">=</span> <span class="fl">10000</span>, parent <span class="op">=</span> <span class="va">whg</span>,
  <span class="va">world</span>,center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">48</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">800</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="spatial-population-expansion" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-population-expansion" class="anchor"></a>Spatial population expansion</h2>
<p>We can simulate the expanding range of a population using the function <code><a href="../reference/expand.html">expand()</a></code>, which accepts a parameter specifying by how many kilometers should the boundary expand (the <code>by</code> argument), how long should the expansion take (the <code>duration</code> argument) and how many intermediate spatial map snapshots should be exported representing this expansion (the <code>snapshots</code> argument).</p>
<p>For instance, let’s represent the expansion of Anatolian farmers (this uses an optional parameter <code>region</code> which restricts the expansion only to Europe, instead of all around Anatolia).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ana</span>, title <span class="op">=</span> <span class="st">"Anatolian farmer population"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ana</span> <span class="op">&lt;-</span> <span class="va">ana</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expand.html">expand</a></span><span class="op">(</span>
    by <span class="op">=</span> <span class="fl">2500</span>,
    duration <span class="op">=</span> <span class="fl">5000</span>,
    snapshots <span class="op">=</span> <span class="fl">10</span>,
    region <span class="op">=</span> <span class="va">europe_anatolia</span>
  <span class="op">)</span></code></pre></div>
<p>Note that in principle, you could specify the entire spatio-temporal history of a population in a single pipeline using the pipe operator <code><a href="../reference/%&gt;%.html">%&gt;%</a></code>.</p>
<p>We can inspect the object returned by the <code><a href="../reference/expand.html">expand()</a></code> function and see that it contains he spatial maps (“snapshots”) of the expansion process across time:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ana</span>
<span class="co">#&gt; spammr 'population' object </span>
<span class="co">#&gt; -------------------------- </span>
<span class="co">#&gt; name: ANA </span>
<span class="co">#&gt; Ne: 8000 </span>
<span class="co">#&gt; split from: OOA </span>
<span class="co">#&gt; split time: 9000 </span>
<span class="co">#&gt; spatial snapshots at: 9000, 8500, 8000, 7500, 7000, 6500, 6000, 5500, 5000, 4500, 4000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; projected CRS: ETRS89-extended / LAEA Europe</span></code></pre></div>
<p>We can (and should) check the results visually:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ana</span>, title <span class="op">=</span> <span class="st">"Anatolian expansion into Europe"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>To visually see what is really going on behind the scene, we can plot the raw form of the expansion:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ana</span>, title <span class="op">=</span> <span class="st">"Anatolian expansion into Europe (not intersected)"</span>, intersect <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div id="population-migration-across-a-landscape" class="section level2">
<h2 class="hasAnchor">
<a href="#population-migration-across-a-landscape" class="anchor"></a>Population migration across a landscape</h2>
<p>To describe a a directional population movement, we can use the function <code><a href="../reference/migrate.html">migrate()</a></code>. This accepts the coordinates of the destination points along the way (<code>trajectory</code>), the <code>duration</code> of the migration, and the number of individual spatial maps to save during export (<code>snapshots</code>, same as the <code><a href="../reference/expand.html">expand()</a></code> function above).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">yam</span>, title <span class="op">=</span> <span class="st">"Yamnaya range"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yam</span> <span class="op">&lt;-</span> <span class="va">yam</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/migrate.html">migrate</a></span><span class="op">(</span>
    trajectory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">48</span><span class="op">)</span>, <span class="co"># migrate to this point</span>
    duration <span class="op">=</span> <span class="fl">1000</span>,        <span class="co"># how many years does the migration take?</span>
    snapshots <span class="op">=</span> <span class="fl">8</span>           <span class="co"># how many intermediate maps should be saved?</span>
<span class="op">)</span></code></pre></div>
<p>We can inspect the object returned by the <code><a href="../reference/migrate.html">migrate()</a></code> function and see that it contains not just the first YAM population range at 7000 years ago, but also the ranges of the intermediate locations:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yam</span>
<span class="co">#&gt; spammr 'population' object </span>
<span class="co">#&gt; -------------------------- </span>
<span class="co">#&gt; name: YAM </span>
<span class="co">#&gt; Ne: 6000 </span>
<span class="co">#&gt; split from: OOA </span>
<span class="co">#&gt; split time: 7000 </span>
<span class="co">#&gt; spatial snapshots at: 7000, 6875, 6750, 6625, 6500, 6375, 6250, 6125, 6000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; projected CRS: ETRS89-extended / LAEA Europe</span></code></pre></div>
<p>Checking the result visually again, we see:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">yam</span>, title <span class="op">=</span> <span class="st">"Intermediate migration maps"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>The migration trajectory can be much more complicated, however. Imagine this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span>
  <span class="st">"nomadic population"</span>, time <span class="op">=</span> <span class="fl">10000</span>, Ne <span class="op">=</span> <span class="fl">1000</span>,
  parent <span class="op">=</span> <span class="va">ooa</span>,
  <span class="va">world</span>,
  center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">60</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">350</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/migrate.html">migrate</a></span><span class="op">(</span>
    trajectory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span>,
    duration <span class="op">=</span> <span class="fl">100</span>,
    snapshots <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>intersect <span class="op">=</span> <span class="cn">F</span>, title <span class="op">=</span> <span class="st">"Migration along a trajectory"</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div id="plotting-multiple-spammr-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-multiple-spammr-objects" class="anchor"></a>Plotting multiple <code>spammr</code> objects</h2>
<p>In addition to plotting individual population ranges, the generic function <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> can handle a combination of population ranges, and can also partition them in individual facets. This is very useful for visual inspection of the specified model and for looking for potential issues before the export of individual spatio-temporal maps.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ooa</span>, <span class="va">whg</span>, <span class="va">neol</span>, <span class="va">yam</span>, <span class="va">ana</span><span class="op">)</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
<div id="rendering-and-export" class="section level2">
<h2 class="hasAnchor">
<a href="#rendering-and-export" class="anchor"></a>Rendering and export</h2>
<p>OK, so far so good. We have nice and fancy way to plot colorful shapes on a map, representing spatio-temporal population dynamics.</p>
<p>The ultimate goal of <code>spammr</code> is a formal specification of spatio-temporal population boundaries for the purpose of forward simulations in SLiM. The crucial piece of machinery which connects the <code>spammr</code> R package with SLiM is an Eidos function called <code>defineSpatialMap()</code> which, among other parameters, accepts a two-dimensional matrix (essentially, a raster image) describing a spatial simulation landscape. See SLiM manual for more information.</p>
<p><strong>TODO: write a short tutorial on the SLiM side of the problem too.</strong></p>
<p>How do we link the visual (still vectorized!) spatial population ranges shown above to SLiM? We need to export them in a rasterized form as greyscale bitmaps The key is a <code>spammr</code> function <code>render</code>()`.</p>
<p>Without any arguments, the function simply generates a (named) list of ggplot2 objects:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="va">whg</span>, <span class="va">ana</span>, <span class="va">neol</span>, <span class="va">yam</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>Each of these objects contains a black-and-white rasterized version of the population range at a particular snapshot in time. Let’s plot one of them (representing the spatial range of the Anatolian farmers 5,500 thousand years ago - already at the stage in which they migrated to central Europe):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maps</span><span class="op">[[</span><span class="st">"ANA_5500"</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>And here’s the whole series:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">maps</span><span class="op">)</span>
<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span>

<span class="co">#&gt; Warning in as_grob.default(plot): Cannot convert object of class list into a</span>
<span class="co">#&gt; grob.</span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>This is what will be ultimately loaded into SLiM, using our back-end SLiM script which will swap different spatial maps in and out, as needed throughout the course of the simulation.</p>
</div>
<div id="todo-and-open-questions" class="section level2">
<h2 class="hasAnchor">
<a href="#todo-and-open-questions" class="anchor"></a>TODO and open questions</h2>
<div id="how-to-tie-the-visual-configuration-to-an-explicit-admixture-graph" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-tie-the-visual-configuration-to-an-explicit-admixture-graph" class="anchor"></a>1. How to tie the visual configuration to an explicit admixture graph?</h3>
<p>I.e., a population <em>A</em> splitting from a population <em>B</em> at a time <em>t</em>, with a <em>Ne</em> of X.</p>
<p>Should this be represented as columns in the annotation data frame in each <code>sf</code> object?</p>
<p>Should this be encoded in a separate table?</p>
</div>
<div id="how-to-validate-the-entire-model" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-validate-the-entire-model" class="anchor"></a>2. How to validate the entire model?</h3>
<p>Currently, the “compilation” procedure dumps the spatial maps in a given format on disk. Presumably (having solved item 1. above), we would also save the table of split times, as well as the table of admixture edges <em>and</em> a table of spatial maps.</p>
<p>The compilation process should validate that the configured visual/split/admixture model is meaningful:</p>
<ol style="list-style-type: lower-roman">
<li><p>Population migration maps should overlap to a reasonable degree? I.e. there should be a sufficient continuity/overlap between consecutive spatial maps over time.</p></li>
<li><p>The overlap model should form a directed acyclic graph - there should be no “unreachable” population states.</p></li>
</ol>
</div>
<div id="how-to-actually-implement-admixture-in-a-spatial-context" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-actually-implement-admixture-in-a-spatial-context" class="anchor"></a>3. How to actually implement admixture in a spatial context?</h3>
<p>For instance, how to enforce that a population <em>C</em> contributes 60% of its ancestry to a population <em>D</em>? What sort of meaning does it actually have in the context of spatial maps and how they will be utilized by the back-end SLiM script?</p>
</div>
<div id="at-which-stage-should-the-the-user-specify-slim-bits-relevant-to-their-work" class="section level3">
<h3 class="hasAnchor">
<a href="#at-which-stage-should-the-the-user-specify-slim-bits-relevant-to-their-work" class="anchor"></a>4. At which stage should the the user specify SLiM bits relevant to their work?</h3>
<p>There’s a clear conflict between every SLiM script being tailored to each specific use-case and the fact that I want to make things as reproducible and automatic as possible.</p>
<p>I have a nice generic SLiM back-end that slurps in the spatial maps, defines population splits and migrations… but that’s just the demographic part. Should the user modify that script in SLiM GUI (which is awesome and a big reason to use SLiM in the first place)? This hurts the reproducibility, but I can’t reasonably implement an R interface to every possible SLiM use-case.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martin Petr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
